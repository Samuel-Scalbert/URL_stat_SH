Reasoning about Measures of Unmeasurable Sets
Marco Console, Matthias Hofer, Leonid Libkin

To cite this version:

Marco Console, Matthias Hofer, Leonid Libkin. Reasoning about Measures of Unmeasurable Sets.
KR 2020 - 17th International Conference on Principles of Knowledge Representation and Reasoning,
Sep 2020, Rhodes / Virtual, Greece. pp.264-273, ￿10.24963/kr.2020/27￿. ￿hal-03128512￿

HAL Id: hal-03128512

https://inria.hal.science/hal-03128512

Submitted on 2 Feb 2021

HAL is a multi-disciplinary open access
archive for the deposit and dissemination of sci-
entific research documents, whether they are pub-
lished or not. The documents may come from
teaching and research institutions in France or
abroad, or from public or private research centers.

L’archive ouverte pluridisciplinaire HAL, est
destinée au dépôt et à la diffusion de documents
scientifiques de niveau recherche, publiés ou non,
émanant des établissements d’enseignement et de
recherche français ou étrangers, des laboratoires
publics ou privés.

Reasoning about Measures of Unmeasurable Sets

Marco Console1 , Matthias Hofer1 , Leonid Libkin1,2
1 University of Edinburgh , 2 ENS-Paris, PSL / INRIA / CNRS, France

Abstract

In a variety of reasoning tasks, one estimates the likelihood
of events by means of volumes of sets they deﬁne. Such sets
need to be measurable, which is usually achieved by putting
bounds, sometimes ad hoc, on them. We address the ques-
tion how unbounded or unmeasurable sets can be measured
nonetheless. Intuitively, we want to know how likely a ran-
domly chosen point is to be in a given set, even in the absence
of a uniform distribution over the entire space.
To address this, we follow a recently proposed approach of
taking intersection of a set with balls of increasing radius,
and deﬁning the measure by means of the asymptotic behav-
ior of the proportion of such balls taken by the set. We show
that this approach works for every set deﬁnable in ﬁrst-order
logic with the usual arithmetic over the reals (addition, mul-
tiplication, exponentiation, etc.), and every uniform measure
over the space, of which the usual Lebesgue measure (area,
volume, etc.) is an example. In fact we establish a correspon-
dence between the good asymptotic behavior and the ﬁnite-
ness of the VC dimension of deﬁnable families of sets. To-
wards computing the measure thus deﬁned, we show how to
avoid the asymptotics and characterize it via a speciﬁc subset
of the unit sphere. Using deﬁnability of this set, and known
techniques for sampling from the unit sphere, we give two
algorithms for estimating our measure of unbounded unmea-
surable sets, with deterministic and probabilistic guarantees,
the latter being more efﬁcient. Finally we show that a discrete
analog of this measure exists and is similarly well-behaved.

1

Introduction

In a variety of reasoning tasks in areas including temporal
and spatial reasoning or answering queries over missing data
one regularly estimates likelihoods of certain events by com-
puting volumes of sets that serve as a mathematical repre-
sentation of such events. Very often these sets are given by
constraints p(¯x) ≤ 0, where p is a multi-variate polynomial
(for instance, x2 + y2 + z2 − 1 ≤ 0 deﬁnes the unit ball in
R3). This of course assumes that the set itself is measurable.
In most cases of reasonable constraints one uses in applica-
tions, bounded sets, such as the unit ball, will be measur-
able. Indeed, the construction of unmeasurable bounded sets
invariably requires the axiom of choice, and it is not very
natural to think of a practical reasoning task that would use
such sets.

On the other hand, there are many tasks (with some
examples outlined below) where we have unbounded sets
of inﬁnite area, volume, etc. That is, the reason for non-
measurability is their unboundedness. We then want to mea-
sure such sets, or rather deﬁne the proportion of the entire
space occupied by it. Thinking of it in a different way, if we
somehow had a uniform distribution on the entire Rn, the
measure of a set X ⊆ Rn would be the probability that a
randomly chosen point in Rn belongs to X.

To start with an abstract example, consider the positive
+ = {(x, y) | x, y ∈ R, x, y > 0}. Intuitively
quadrant R2
it is clear that it occupies a quarter of R2. If in addition we
restrict it to X1 = {(x, y) ∈ R2+ | y ≥ x}, then this
set occupies 1/8th (or 0.125) of R2. But what about X2 =
{(x, y) ∈ R2 | y ≥ 2x}? Suddenly the intuition is lost. We
shall later argue that the measure is roughly 0.074.

Before we explain how we arrive at this, we look at other
examples where such reasoning about measures of unmea-
surable sets could be of use.

Temporal reasoning Temporal networks are a formalism
that captures relationships between points in time. They can
deﬁne bounds (event x happens between 1pm and 3pm), rel-
ative constraints (event x precedes event y), and metric con-
straints (event x happens three hours before event y). As ar-
gued in (Dechter, Meiri, and Pearl 1991) and much followup
work, temporal networks can be represented by semi-linear
sets, i.e., sets deﬁnable in the theory of the reals with ad-
dition. For example, to model a multi-step chemical reac-
tion one needs a Boolean combination of conditions saying
that forming y from x requires at least time t, deﬁned by
y − x ≥ t. The standard reasoning task performed with tem-
poral networks is satisﬁability, i.e., checking whether there
exists a conﬁguration of the events consistent with the con-
straints. This gives a yes/no answer, but it cannot tell how
likely a consistent conﬁguration is. To answer the latter, we
need to impose ﬁxed (and quite possibly ad hoc) bounds.

Consider, e.g., constraints (0 ≤ y ≤ 3) ∨ (y ≥ x + 12)
indicating a successful outcome if y happens in the ﬁrst 3
hours of observation, or 12 hours after x happen. If we re-
strict our attention to 24 hours only, these constraints are sat-
isﬁed by points (x, y) ∈ R2 whose area is 25% of the area of
[0, 24] × [0, 24]. But what if we do not have this upper bound

of 24 hours and want to see how likely these constraints are?
Intuitively, without an upper bound the constraint 0 ≤ y ≤ 3
is very unlikely, and y ≥ x + 12 will happen with probabil-
ity 1/2 for randomly chosen points x and y. The question is
then how to formalize this intuition.

Querying missing data
In database applications, or appli-
cations involving reasoning about data and querying (e.g.,
data integration (Lenzerini 2002) or OBDA (Bienvenu and
Ortiz 2015)) one often has to deal with missing data repre-
sented by null values: essentially markers saying that some
piece of data is not known at the moment. In data science,
one often uses imputation techniques, i.e., replacing missing
data by concrete values and then applying usual querying
techniques. This is often suboptimal as it loses any infor-
mation about the fact that data was not initially there, and
in database applications techniques for querying complete
and incomplete data are rather different (Imielinski and Lip-
ski 1984; Libkin 2016a). The latter is based on the notion
of certain answers assumed to be the correct one, although
it tends to be computationally very expensive. Various so-
lutions have been proposed such as approximation schemes
(Feng et al. 2019; Greco, Molinaro, and Trubitsyna 2019;
Libkin 2016b) or weaker probabilistic guarantees (Libkin
2018). The latter essentially estimates how likely a query
is to be true in a randomly chosen database. They work well
for simple constraints used in queries – essentially equalities
of values. In real-life queries with arithmetic operations are
ubiquitous, and one needs to estimate the likelihood of con-
ditions exactly like those speciﬁed above: y ≥ x or y ≥ 2x.
If variables have naturally restricted ranges (e.g., profes-
sorial salaries, or class sizes in logic), it is easy to estimate
the volume of the set deﬁned by the constraints. If however
the ranges of variables could be unbounded (e.g., salaries of
executives, or class sizes in machine learning) we need to es-
timate a proportion of the entire space cut by the constraints
– the exact problem described above.

(cid:75)

(cid:74)

α

α ∧ ¬β

α ∧ β
(cid:74)

Default Reasoning To understand what a default
is,
(Koutras et al. 2018) proposed to connect it with topological
that satisfy a formula α.
properties of the set of worlds
Then β is a default consequence of α if
is “small”
is “large”. When dealing with measurable sets,
and
one can deﬁne this via a degree of overlap of
,
(cid:75)
i.e., by Vol(α ∧ β) ≤ τ Vol(α), for some threshold τ . This
notion of default is very natural, but it falls short in the case
of unbounded sets of inﬁnite volume. If we could measure
such sets, we could extend such a default reasoning approach
to more general settings permitting fewer restrictions on sets
of possible worlds.

and

(cid:75)
α

β

(cid:74)

(cid:75)

(cid:74)

(cid:75)

(cid:74)

Spatial Reasoning Reasoning about the spatial conﬁgura-
tion of geometrical objects is a prominent AI application. An
example of languages for spatial reasoning is RCC8 (Egen-
hofer and Franzosa 1991; Kontchakov, Pratt-Hartmann, and
Zakharyaschev 2010) based on topological primitives such
as containment and disjointness relations. Sometimes how-
ever a quantitative aspect needs to be added, for instance
for reasoning on how big an overlap of two sets is. This
was proposed in (Godoy and Rodr´ıguez 2002); the over-
lap of two measurable sets A and B can be deﬁned as

Overlap(A, B) = Vol(A)/Vol(A ∪ B). However if sets A
and B are unmeasurable this is again undeﬁned. The prob-
lem can be “ﬁxed” by imposing some arbitrary restrictions,
e.g, looking at the restriction of A and B to points whose
Euclidean norm is bounded by some number r, but then it
depends on an ad hoc choice of r. By being able to measure
unmeasurable sets, we would eliminate this ad hoc depen-
dence.

Our goal is to deﬁne such measures and study their
structural and computational properties. This problem was
ﬁrst studied (Console, Hofer, and Libkin 2019) using
the following approach. It ﬁrst deﬁned the measure of a
set X restricted to the ball of radius r as mr(X) =
Vol(X ∩ Bn
r ) ∈ [0, 1], and then set m(X) =
limr→∞ mr(X). It showed the following:
• For sets X deﬁnable with the common functions such as
+, ·, −, ÷, sx for s > 0 etc, m(X) is well-deﬁned, i.e.,
the limit exists (but see more on this below);

r )/Vol(Bn

• Even with + available, m(X) is usually an irrational
number and needs to be approximated. An approximation
scheme with additive error guarantees was given for lin-
ear constraints in a speciﬁc syntactic shape (essentially
a union of convex polytopes). Additive error guarantees
are necessary since there are provably no approximation
schemes with multiplicative error guarantees, even for or-
der constraints.
This leaves a multitude of questions unanswered that we

outline now, together with our contributions.

Why Lebesgue measure? It was motivated by the fact that
we know how to sample uniformly from the n-dimensional
ball, and this could be useful in approximation schemes. But
could we get different values of m(X) with different uni-
form measures on bounded subsets of Rn? We show that
this is not the case.

Existence of the measure. The proof of the existence of
m(X) cited above relied on a result from (Karpinski and
Macintyre 1997) on approximability of volumes by ﬁrst-
order formulae. The proof of (Console, Hofer, and Libkin
2019) used the result as stated in that paper, but the ac-
tual proof of (Karpinski and Macintyre 1997) added an ex-
tra assumption. It restricted sets whose volumes are ap-
proximated to subsets of [0, 1]n, rather than [−r, r]n for
arbitrary r > 0, as the construction of (Console, Hofer,
and Libkin 2019) crucially required. We show nonetheless
that the existence result for m(X) not only remains true
but is even more general than the previously claimed re-
sult – at the expense of, not surprisingly, a more compli-
cated proof. The key point is that sets deﬁnable with the
help of functions that do not exhibit a period behavior, such
as +, ·, −, ÷, sx, logs(x), are ﬁne, but those with a periodic
behavior such as sin, cos, tan, arcsin etc, are not.

Measure via unit spheres. We ﬁnd a new characterization
of m(X) for X ⊆ Rn in terms of areas of some sets, called
Ult(X), on the unit sphere in Rn. That is, one only has to
look at one speciﬁc sphere of a ﬁxed radius to determine the
asymptotic behavior.

Approximating m(X) by sampling from the sphere. The ad-
vantage of the new characterization stems from the fact that
we have well-understood algorithms for generating points
uniformly on the unit sphere in Rn, see (Blum, Hopcroft,
and Kannan 2020). This leads to two new algorithms for
estimating m(X), i.e., returning a number in the interval
m(X) ± ε for a given ε > 0. One is a deterministic algo-
rithm, while the other is randomized (using sampling from
the unit sphere in an essential way) and having much better
complexity.

Moreover, existing algorithms were very restrictive: they
worked only for sets deﬁnable by linear inequalities, and
only guaranteed good complexity when such sets had a
speciﬁc representation that was effectively a union of con-
vex polytopes. The new approach gives us an algorithm
that works for sets deﬁnable with any of the usual arith-
metic function (addition, multiplication, exponentiation,
logarithms). Furthermore, in its randomized version it re-
mains efﬁcient without any restrictions on the syntactic
shape of formula that deﬁnes the set.

Discrete measure. Finally, we also study a discretization of
the measure, that, instead of using the volume, counts the
number of integer points in a set. We show that our approach
is robust, as this measure in the limit coincides with the pre-
viously deﬁned one.

Due to space limitations, proofs are only sketched in this

submission. Full proofs are available at
http://bit.ly/38GN8WV.

2 Preliminaries
We use N, Z, Q, and R to denote natural, integer, rational,
and real numbers. Elements of Rn are n-dimensional points,
i.e., tuples ¯a = (a1, . . . , an) of real numbers. By (cid:107)¯a(cid:107) we
denote its Euclidean norm ((cid:80)n
r for
the n-dimensional ball of radius r, i.e., {¯a ∈ Rn | (cid:107)¯a(cid:107) ≤ r}
and Sn−1
for its boundary, the (n − 1)-sphere, i.e., {¯a ∈
r
Rn | (cid:107)¯a(cid:107) = r}.

i )1/2. We write Bn

i=1 a2

If X ⊆ Rn, we denote by Voln(X)

the n-
dimensional Lebesgue measure of X 1. More generally,
Volk(X) denotes the k-dimensional Lebesgue measure
when the dimension of X is k or smaller. For example,
Voln(Bn
) =
√
πnrn−1/Γ(n/2). We omit indices and write just Vol
2
when the dimension is clear from the context.

πr)n/Γ(n/2 + 1) and Voln−1(Sn−1

r ) = (

For a set X ⊆ Rn, a point ¯a ∈ Rn, and c ∈ R, we write
¯a + X for {¯a + ¯x | ¯x ∈ X} and c · X for {c · ¯x | ¯x ∈ X}.

√

r

We deal with sets deﬁnable in ﬁrst-order languages
over structures on numbers (primarily R). They are deter-
mined by the vocabulary Ω of allowed functions such as
+, ·, ex, ln x, sin x. We assume that the standard compar-
isons < and = are always available. First-order formulae
in the language of Ω are deﬁned in the usual way. Given

1Readers unfamiliar with measure theory can think of Lebesgue
measure as the extension of lenght, area, and volume to multi-
dimensional spaces. This will not affect in any way the understand-
ing of the paper.

a countably inﬁnite set VAR of variables, each number and
each variable are terms, and if t1, . . . , tn are terms, and f
is a n-ary function then f (t1, . . . , tn) is a term. If t, t(cid:48) are
terms, then t = t(cid:48) and t < t(cid:48) are atomic formulae. Formu-
lae are closed under the Boolean connectives ∨, ∧, and ¬,
and under quantiﬁers ∃ and ∀. Deﬁnitions of free and bound
variables are standards, and we write ϕ(¯x) to indicate that ¯x
is the tuple of free variables of ϕ.

The semantics of these is standard. Given a formula ϕ(¯x)
with ¯x of length n, and a n-tuple ¯a over R, we say that ϕ(¯a)
is true if it is satisﬁed in the structure (cid:104)R, Ωϕ(cid:105) where Ωϕ
contains all the functions and comparison predicates used in
ϕ. The set of all ¯a such that ϕ(¯a) is true is denoted by
; it
is a subset of Rn. For example, if ϕ(x, y) = (x·x+y·y ≤ 1)
then

ϕ
(cid:75)

(cid:74)

= B2
1 .

ϕ
(cid:75)

(cid:74)

3 When can we measure unmeasurable sets?
We start by recalling the measure as deﬁned in (Console,
Hofer, and Libkin 2019). Consider an arbitrary set X ⊆ Rn
so that for each n-dimensional ball Bn
r of radius r, the set
X ∩ Bn

r is Lebesgue-measurable. Deﬁne then

mr(X) =

Vol(X ∩ Bn
r )
Vol(Bn
r )

and m(X) = lim
r→∞

mr(X) . (1)

Of course Bn

In other words, we take the proportion of the r-ball occupied
by X, and see how it behaves when r increases. For sets
deﬁnable by formulae, we shall write m(ϕ) for m(
(cid:74)

r is the set of points ¯a with (cid:107)¯a(cid:107) ≤ r, and
in principle one could have used another norm (cid:107)¯a(cid:107)p =
(cid:0) (cid:80)n
for p between 1 and ∞, but for all of those
except for the case of p = 2 the measure m(X) deﬁned via
them would not be invariant under volume-preserving trans-
formations such as rotations. This is the reason for using the
Euclidean norm.

i=1 |ai|p(cid:1)1/p

ϕ
(cid:75)

).

We ﬁrst show that instead of the Lebesgue measure Vol(·),
we could use any well-behaved measure on Rn. A measure
µ on Rn is uniform if for every two points ¯a1 and ¯a2 and ev-
ery r > 0 we have µ(¯a1 + Bn
r ), see (Mattila
1995). Note that this is not the same as a uniform distribu-
tion, which does not exist over Rn, while uniform measures
exist (e.g., the Lebesgue measure). Given such a measure
µ, we normalize it by considering µr(·) = µ(·)/µ(Bn
r ) so
that µr(Bn
r (X) =
µr(X ∩ Bn

r ) = 1. Then, for a set X, we deﬁne mµ
r ) and mµ(X) = limr→∞ mµ

r ) = µ(¯a2 + Bn

r (X).

It turns out that with every reasonable uniform measure
µ, we get the same value mµ as was given by (1) for the
Lebesgue measure. The condition we need is that µ does not
assign non-zero values to sets X with Vol(X) = 0. This is
known in measure theory as being absolutely continuous.
Proposition 1. If µ is a uniform absolutely continuous mea-
sure, then mµ = m.

With this Proposition and the justiﬁed use of the measure

m, we now move to the existence result.

Existence of the measure
The measure m(X) may not exist for two reasons: ﬁrst,
some of the sets X ∩ Bn
r may not be Lebesgue-measurable,

and second, the limit in (1) may not exist. We now give a
general model-theoretic criterion for the existence of m(X)
for sets X deﬁnable in ﬁrst-order logic over structures
(cid:104)R, · · · (cid:105); such structures use various arithmetic functions
and comparisons such as = and <. We then show that these
general conditions apply in many structures of interest and
capture the usual arithmetic functions.

(cid:74)

ϕ
(cid:75)

A set X is deﬁnable if there is a ﬁrst-order formula ϕ
= X. A function is deﬁnable if its graph is
so that
deﬁnable. For example, subtraction is deﬁnable in (cid:104)R, +(cid:105),
division in (cid:104)R, +, ·(cid:105), and logs(x) in (cid:104)R, +, ·, ex(cid:105) for each
ﬁxed s > 0. To see the latter notice that y = logs(x) iff
e(ln s)·y = x. We assume that constants, i.e., elements of R
such as ln s, can be used in formulae.

We say that (cid:104)R, · · · (cid:105) has deﬁnable Skolemization if for
each deﬁnable X ⊆ R2 there is a deﬁnable function fX
so that (x, fX (x)) ∈ X whenever x is such that there is
some pair (x, y) ∈ X. We say that a deﬁnable function f :
R → R is eventually monotone if there is an x0 ∈ R such
that f is monotone on (x0, ∞). That is to say, f is either
monotonically increasing (x ≥ x(cid:48) imply f (x) ≥ f (x(cid:48))) or
monotonically decreasing (x ≥ x(cid:48) imply f (x) ≤ f (x(cid:48))).

Given a formula ϕ(¯x, ¯y, ¯z), with |¯x| = n and |¯y| = m,
for each tuple ¯c of the same length as ¯z it deﬁnes a family
Φ¯c = {¯a ∈ Rn | ϕ(¯a, ¯b, ¯c) holds}¯b∈Rm of subsets of Rn.
Recall that for a family Φ of subsets of Rn, its VC dimen-
sion is the maximum cardinality of a ﬁnite C ⊆ Rn such
that {C ∩ F | F ∈ Φ} = 2C; if no such maximum exists,
then the VC dimension is inﬁnite, cf. (Anthony and Biggs
1992). If for every such ﬁrst-order formula ϕ(¯x, ¯y, ¯z) their
is a number v so that the VC dimension of all Φ¯c is at most v
we say that every parameterized deﬁnable family has ﬁnite
VC dimension.

Now we are ready to formulate the existence theorem.
Theorem 1. Suppose we have a structure (cid:104)R, +, ·, <, · · · (cid:105)
such that:

• every parameterized deﬁnable family has ﬁnite VC dimen-

sion;

• it has deﬁnable Skolemization for every deﬁnable subset

of R2;

• every deﬁnable function f : R → R is eventually mono-

tone;

• every bounded deﬁnable set is Lebesgue-measurable.

Then m(X) exists for every deﬁnable set X.

Examples The key example of structures on reals satis-
fying conditions of the Theorem are o-minimal structures,
cf. (Van den Dries 1998), that are structures on R so that
for every ﬁrst-order formula ϕ(x) with one free variable,
⊆ R is a ﬁnite union of intervals. The best known exam-
ϕ
ple is the real ﬁeld (cid:104)R, +, ·, 0, 1, <(cid:105); we can also assume that
(cid:74)
(cid:75)
each element c ∈ R is available as a constant. This follows
from Tarski’s quantiﬁer elimination: every formula ϕ(x) is
equivalent to a Boolean combination of polynomial inequal-
ities p(x) ≤ 0, and in intervals deﬁned by roots of all such
polynomials the truth value of ϕ does not change.

A remarkable example of o-minimality is the exponential
ﬁeld (cid:104)R, +, ·, ex(cid:105), see (Wilkie 1996). In this structure one
has +, −, ·, ÷, sx, logs(x) deﬁnable (for s > 0). What is not
deﬁnable in o-minimal structures are functions and sets with
a periodic behavior, e.g., N, or trigonometric functions sin,
cos, arcsin, arccos, etc.

That o-minimal structures satisfy the conditions of the
theorem follows from their well-known properties. Finite-
ness of VC dimension (with parameters) and eventual mono-
tonicity are explicitly stated in (Van den Dries 1998). Cell
decomposition (Van den Dries 1998) ensures that each de-
ﬁnable set is a ﬁnite union of cells which are open sets
(in their dimension) and thus measurable if bounded. Fi-
nally, for a deﬁnable set X ⊆ R2, by o-minimality each
Xx = {y | (x, y) ∈ X} is a ﬁnite union of intervals, and
one can simply take the midpoint of the smallest one (or a−1
for the interval (−∞, a) and a + 1 for (a, ∞)).

There are generalizations of o-minimality that have ﬁ-
nite VC dimension and other properties such as quasi-
o-minimality (Belegradek, Peterzil, and Wagner 2000) to
which the result would apply as well.

Proof sketch of the existence theorem Assume we have
a structure on the reals as in the statement of the Theorem.
Given a formula α(¯x, ¯y) with |¯x| = n and |¯y| = m, and
¯a ∈ Rn, we shall use the notation α(¯a, Rm) for the set of ¯b ∈
Rm so that α(¯a, ¯b) holds. In the proof below, every reference
to Vol(·) will involve a bounded deﬁnable set, and thus by
the last assumption the Lebesgue measure is well deﬁned.
Suppose we have a formula α(¯y, ¯u), and ﬁx ε > 0. Then a
formula β(¯y, z) is called an ε-volume approximation for α
if two conditions are satisﬁed. First, for every interpretation
¯a of ¯y, there exists v ∈ R such that β(¯a, v) holds. Second,
if β(¯a, v) holds, then |v − Vol(α(¯a, Rm)| < ε, where m is
the length of ¯u. Recall that α(¯a, Rm) is the set of all ¯b ∈ Rm
such that α(¯a, ¯b) holds.

It was shown in (Karpinski and Macintyre 1997) (see
also (Koiran 1995)) that, under some conditions, as long
as α(¯a, Rm) ⊆ [0, 1]m for each ¯a, such ε-volume approx-
imation exists for each ε > 0. The conditions, as one fol-
lows speciﬁcally the construction in (Karpinski and Macin-
tyre 1997), are the availability of + in the vocabulary of the
structure, and the ﬁnite VC dimension of parameterized de-
ﬁnable families. Essentially, using +, it constructs from α
another formula with parameters, and based on the VC di-
mension of the family it deﬁnes, constructs yet another for-
mula deﬁning the volume, again referring to α and using +.
The result is even stronger: produced formulae ensure that
|v − Vol(α(¯a, Rm)| < ε/4 implies that β(¯a, v) holds.

Now suppose we are given a formula ϕ(¯x) in n variables.
We shall prove that m(ϕ) exists. Note that there is an FO
formula in n + 1 variables deﬁning the condition (cid:107)¯x(cid:107) ≤ r,
where the length of ¯x is n, simply by checking x2
n ≤
r2; where ¯x = (x1, . . . , xn). Thus, for ϕ(¯x) we can deﬁne
a new formula ϕ(cid:48)(r, ¯x) = ϕ(¯x) ∧ ((cid:107)x(cid:107) ≤ r). The formula
r , i.e., ϕ(cid:48)(r, ¯a) is true for
ϕ(cid:48)(r, ¯x) deﬁnes the set

1 +· · · x2

∩ Bn

ϕ
(cid:75)

(cid:74)

∩ Bn

every ¯a ∈ (
(cid:74)
ψ(r, ¯x) = ∃y1, . . . , yn

ϕ
(cid:75)

r ). Consider next the formula

(cid:0)ϕ(cid:48)(r, ¯y) ∧

n
(cid:94)

i=1

xi = (yi + r)/2r(cid:1) .

(cid:0)ϕ(cid:48)(r, Rn) + (r, . . . , r)(cid:1) and thus
Then ψ(r, Rn) = 1
2r
ψ(r, Rn) ⊆ [0, 1]n. Adding a ﬁxed vector (r, . . . , r) does
not change the volume, and dividing each coordinate by 2r
corresponds to a linear transformation whose matrix has 2r
in each diagonal position; thus we have Vol(ψ(r, Rn)) =
Vol(ϕ(cid:48)(r, Rn))/(2r)n, and hence, since Vol(Bn
r ) = bn · rn
where bn = πn/2/Γ(n/2 + 1),

mr(ϕ) =

Vol(ϕ(cid:48)(r, R))
bn · rn

=

2n
bn

Vol(ψ(r, Rn)) .

(2)

Using the volume approximating formulae described above,
we can now deﬁne a formula α(cid:48)
ε(z, y), for each ε > 0, so
that α(cid:48)(r, R) (cid:54)= ∅ for each r > 0 and α(cid:48)
ε(r, v) implies |v −
Vol(ψ(r, Rn))| < ε. By (2) it means that there are formulae
αε(z, y) such that α(r, R) (cid:54)= ∅ for each r > 0 and αε(r, v)
implies |v − mr(ϕ)| < ε. Using this, we show
Lemma 1. For each ε > 0, there is a function fε : R → R
such that |mr(ϕ) − fε(r)| < ε for each r > 0 and
limr→∞ fε(r) exists.

Indeed, the formula αε(z, y) deﬁnes a subset R2 and thus
there exists a deﬁnable Skolem function fε : R → R such
that αε(z, fε(z)) holds and hence |mr(ϕ) − fε(r)| < ε.
We can assume this function to be total by assigning it a
ﬁxed value for all r ≤ 0. Thus again by the assumption
on the structure this function is eventually monotone. Note
that the function is also bounded as |mr(ϕ) − fε(r)| < ε
and mr(ϕ) ∈ [0, 1]. Assume that function fε is monotoni-
cally nondecreasing after some r0 > 0 (the case of fε be-
ing monotonically nonincreasing is symmetric). Because of
boundedness we have s = supr>r0 fε(r) exists. By mono-
tonicity, it easily follows that s = limr→∞ fε(r).

Using the lemma deﬁne Lε = limr→∞ fε(r). Since
|fε(r) − fδ(r)| < ε + δ, we have |Lε − Lδ| < ε + δ. Next
we show that L = limε→0+ Lε exists. Indeed, ﬁx any δ > 0.
Then for ε1, ε2 < δ/2 we have |Lε1 − Lε2 | < δ and thus by
Cauchy convergence (viewing Lε as a function from R+ to
R) the limit of Lε exists.
We ﬁnally prove

theorem by showing that
limr→∞ mr(ϕ) = L. Fix δ > 0. Then there is
ε > 0 and r0 > 0 such that for all r > r0 we
have that each of |mr(ϕ) − fε(r)|,
|fε(r) − Lε|, and
is smaller than δ/3. Then |mr(ϕ) − L| ≤
|L − Lε|
|mr(ϕ) − fε(r)| + |fε(r) − Lε| + |L − Lε| < δ as required.
All of these three statements are routine to prove.

the

Remark As explained in the introduction, the key omis-
sion in the previously claimed proof of the existence result
(stated only for o-minimal structures) was the assumption
that α(¯a, Rm) ⊆ [0, 1]m needed for volume approximation.
It is essential in the proof of (Karpinski and Macintyre 1997)
but was not stated in the statement of the result that was
quoted in (Console, Hofer, and Libkin 2019). The new proof
is considerably more complicated as we work with relative
rather than absolute approximations of volumes.

Basic Properties
The Lebesgue measure is known for being well-behaved,
and some of its good properties carry over to our measure
m. We analyze the most important aspects: positivity, mono-
tonicity, translation invariance, the characterization of zero
sets and the interaction with Cartesian product. The latter
two will require techniques to be developed in the next sec-
tion.
Proposition 2. For any collection {Xi}i∈N of subsets of Rn
such that Xi ⊆ Xj whenever i ≤ j, if m(Xi) exists for all
i ∈ N then:
• m(Xi) ≥ 0;
• m(Xi) ≤ m(Xj);
• m((cid:83)
Furthermore, if m(X) exists for X ⊆ Rn, then m(c · X) =
m(¯a + X) = m(X) for every c > 0 and ¯a ∈ Rn.

i≥1 Xi) = limn→∞ m(Xn);

4 An alternative characterization
We now provide a characterization of the measure m(X)
in terms of the usual Lebesgue measure of subsets of a
unit sphere (or a sphere of a ﬁxed radius). One immediate
advantage is that the characterization eliminates the need
to reason about asymptotics. The second advantage is that
such a characterization is useful for algorithmic character-
ization. Indeed, there are well-known techniques for sam-
pling points from a sphere (Blum, Hopcroft, and Kannan
2020), and these will be used later to provide good estimates
for m(X). In this section we concentrate on sets deﬁnable
in o-minimal structures over the reals, i.e., sets deﬁnable in
ﬁrst-order logic with operations such as +, ·, sx, etc.

Since the likelihood measure m is deﬁned as a limit, it is
intuitively clear that it does not depend on any ﬁnite parts,
i.e., intersections of X with balls of small radius. This intu-
ition is right, and the important aspect, when it comes to the
computation of m(X), is the asymptotic satisfaction of the
formula into the individual directions. That means, for any
point from the unit sphere, ¯z ∈ Sn−1
, we only need to deter-
mine whether X ultimately covers the ray c · ¯z, i.e. whether
there is a value c0 > 0 such that for all c > c0 we have
(c · ¯z) ∈ X. The proportion of points ¯z from the unit sphere
for which this is the case determines m(X). More formally,
we ﬁrst give the following deﬁnition.
ultimately covers X ⊆ Rn
Deﬁnition 1. A vector ¯z ∈ Sn−1
r
if there exists c0 ∈ R+ such that c · ¯z ∈ X for all c > c0.
The set of such vectors is denoted by Ultr(X).

1

(cid:74)

ϕ
(cid:75)

If X =

, we write Ult(ϕ) and refer to ¯z ∈ Ult(ϕ) as
ultimately satisfying ϕ. Note that the radius r is irrelevant in
this deﬁnition, as Ultr(ϕ) = r · Ult1(ϕ), and thus, when we
write Ult(ϕ), or Ult(X), we actually mean Ult1(ϕ), i.e., the
set of all ultimately satisfying vectors on the unit sphere.

The power of o-minimality tells us that for a formula ϕ(¯x)
with |¯x| = n over such a structure, we have a dichotomy: ev-
ery point ¯z on the unit sphere is either in Ult(ϕ) or Ult(¬ϕ).
Lemma 2. If ϕ is over an o-minimal structure on R, then
Ult(ϕ) = Ult(¬ϕ).

Proof. Given ϕ(¯x), and ¯z ∈ Sn−1, deﬁne a formula ψ(y) in
one free variable as ϕ(y·¯z). By o-minimality (which remains
true if we add constants for all elements of R), this formula
deﬁnes a ﬁnite union of intervals. Thus, there is c0 such that
either for all c > c0 we have ψ(c) or for all c > c0 we have
¬ψ(c). It is clear that the former implies ¯z ∈ Ult(ϕ) and the
latter that ¯z ∈ Ult(¬ϕ) and thus Ult(ϕ) = Ult(¬ϕ).

Now using this lemma we prove the main characteriza-
tion result for m(X) where X is deﬁnable in an o-minimal
structure.

Theorem 2. Let ϕ(¯x), with |¯x| = n, be a formula over an
o-minimal structure (cid:104)R, <, · · · (cid:105). Then

m(ϕ) =

Voln−1(Ult(ϕ))
Voln−1(Sn−1
)

1

.

Proof Sketch. Let Z ⊆ Sn−1. Deﬁne cone(Z) = {c · ¯z |
¯z ∈ Z, 0 ≤ c ≤ 1}. We show that for every ε > 0 there is a
value r0 such that for all r ≥ r0 we have that:
Voln−1(Ult(ϕ))
Voln−1(Sn−1
)

Voln(
∩ Bn
r )
ϕ
(cid:74)
(cid:75)
Voln(Bn
r )

≤ ε

(3)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

−

1

From now on, let ε > 0 be ﬁxed. We start by proving the
following

Voln−1(Ult(ϕ))
Voln−1(Sn−1
)

1

=

Voln(cone(Ultr(ϕ)))
Voln(Bn
r )

to ensure the same denominator. Next, we have that
(cid:90) r

Voln(
(cid:74)

ϕ
(cid:75)

∩ Bn

r ) =

Voln−1(
(cid:74)

ϕ
(cid:75)

0

∩ Sn−1
x

)dx and

Voln(cone(Ultr(ϕ))) =

(cid:90) r

0

xn−1 · Voln−1(Ult(ϕ))dx .

Setting Sϕ,x =

ϕ
(cid:75)
(cid:74)

∩ Sn−1
x

, we get that

(cid:90) r

0

Voln−1(Sϕ,x)dx −

(cid:90) r

0

xn−1 · Voln−1(Ult(ϕ))dx ≤

(cid:90) r

≤

|Voln−1(Sϕ,x) − xn−1 · Voln−1(Ult(ϕ))|dx

0

≤ rn−1

(cid:90) r

0

|Voln−1(

1
x

· Sϕ,x) − Voln−1(Ult(ϕ))|dx

We refer to the last value in the above equation as u. Next,

we note that

Voln−1(

lim
x→∞

1
x

· Sϕ,x) = Voln−1(Ult(ϕ)) .

That is, for all ε(cid:48) > 0 there is a value x0 such that for all x ≥
x · Sϕ,x) − Voln−1(Ult(ϕ))| ≤ ε(cid:48).
x0 we have that |Voln−1( 1
Since we are interested in proving (3) for r → ∞ we
assume that we take r sufﬁciently large so that r > x0. Fix
ε(cid:48) < cn · ε, where bn = π n
2 /Γ( n
2 + 1) is the ball constant.
Then we get the following estimate on u:

(cid:90) x0

u = rn−1 · (

|Voln−1(

1
x

· Sϕ,x) − Voln−1(Ult(ϕ))| +

0

+

(cid:90) r

x0

|Voln−1(

1
x

· Sϕ,x) − Voln−1(Ult(ϕ))|)

≤ rn−1 · (x0 · Voln−1(Sn−1

x0

) + ε(cid:48) · r)

Now, we set c0 = x0 · Voln−1(Sn−1

x0

), and get that

Voln(
(cid:74)

ϕ
(cid:75)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

∩ Bn

r ) − Voln(cone(Ultr(ϕ)))
Voln(Bn
r )

(cid:12)
(cid:12)
(cid:12)
(cid:12)

≤

c0
cn · r

+

ε(cid:48)
cn

which is smaller than ε as long as r > c0/(cn · ε − ε(cid:48)). This
proves (3) and the theorem.

For the example in the introduction of X = {(x, y) |
x, y ≥ 0, y ≥ 2x}, the set Ult(X) is the arc of S1 corre-
sponding to angles between arctan(2) and π/2, and hence
Vol1(Ult(X))/2π = 1/4−arctan(2)/2π, or approximately
0.074, as claimed.

An immediate corollary of Theorem 2 is that we can use

uniform sampling from the unit sphere to evaluate m(X).
Corollary 1. For a set X ⊆ Rn deﬁnable in an o-minimal
structure over R, we have

m(X) = Prob(Z ∈ Ult(X))

where Z ∼ U(Sn−1
uniformly distributed on the unit-sphere.

1

), i.e. Z is a random variable that is

Additional properties of the measure We can use Theo-
rem 2 to establish additional properties of the measure about
its zero sets, and its interaction with the Cartesian product.
Proposition 3. Consider an o-minimal structure over R,
and two deﬁnable sets X ⊆ Rn and Y ⊆ Rm. Then

• m(X) = 0 iff Voln−1(Ult(X)) = 0.
• m(X × Y ) = m(X) · m(Y ).

Proof sketch. The ﬁrst item is a direct consequence of The-
orem 2. For the second, let n + m independent and identi-
cally distributed random variables Zi be given, with Zi ∼
N (0, 1), i.e. the Zi are distributed according to the stan-
dard normal distribution. Then, we know that for ¯Z =
(Z1, . . . , Zn+m) we have that ¯Z/(cid:107) ¯Z(cid:107) ∼ U(Sn+m−1
), i.e
it is uniformly distributed on the (n + m − 1)-sphere, see
(Blum, Hopcroft, and Kannan 2020). When we deﬁne the
following two random variables, ¯ZX = (Z1, . . . , Zn) and
¯ZY = (Zn+1, . . . , Zn+m). It is easy to see that (¯x, ¯y) ∈
Ult(X × Y ) iff ¯x/(cid:107)¯x(cid:107) ∈ Ult(X) and ¯y/(cid:107)¯y(cid:107) ∈ Ult(Y ). Us-
ing this and Corollary 1 we show:

1

= Prob

m(X × Y ) = Prob( ¯Z/(cid:107) ¯Z(cid:107) ∈ Ult(X × Y ))
(cid:16) ¯ZX /(cid:107) ¯ZX (cid:107) ∈ Ult(X) and ¯ZY /(cid:107) ¯ZY (cid:107) ∈ Ult(Y )(cid:1)
= m(X) · m(Y ) .

5 Robustness of the deﬁnition
Before using the characterizations of Theorem 2 and Corol-
lary 1, we show that the measure m(X) is very robust. We
propose two alternatives – one using spheres instead of balls,
and the other one using integer lattice points instead of com-
puting the volume – and show that the measures they give
rise to coincide with m(X).

Using spheres rather than balls
Instead of using X ∩Bn
have used X ∩ Sn−1

r in the deﬁnition of m(X), we could
and Voln−1(·). That is, we could deﬁne

r

m◦

r(ϕ) =

Voln−1(

∩ Sn−1
ϕ
r
(cid:74)
(cid:75)
Voln−1(Sn−1
)

r

)

(cid:74)

ϕ
(cid:75)

r(ϕ). When X =

and m◦(ϕ) = limr→∞ m◦
we shall
write m◦(ϕ). In general it is easy to ﬁnd cases when m(X)
exists while m◦(X) does not. Consider, for instance, the set
X of all ¯z in Rn such that (cid:107)¯z(cid:107) is irrational. Then mr(X) = 1
for all r, and yet m◦
r(X) is 1 when r is irrational and 0 when
r is rational and hence m◦(X) does not exist. Nonetheless,
for sets deﬁnable in nice logical theories like (cid:104)R, +, ·, ex(cid:105),
the measure deﬁned over spheres exists and is the same as
the one we used.
Theorem 3. Let X be deﬁnable in an o-minimal structure.
Then m◦(ϕ) = m(ϕ).

The proof uses techniques similar to those in the proof of

Theorem 2.

Using integers rather than reals
An alternative approach is not to deﬁne the measure of the
sets via volumes but rather by the number of points in the
integer lattice Zn. More precisely, for a set Y ⊆ Rn, deﬁne
VolZ(Y ) as the cardinality of the set |Y ∩ Zn|, and then set

mZ

r (ϕ) =

VolZ(
∩ Bn
r )
ϕ
(cid:74)
(cid:75)
VolZ(Bn
r )

and mZ(ϕ) = lim
r→∞

mZ

r (ϕ) .

r )| = o(rn), see (Kr¨atzel 1988).

This is indeed a natural measure when we deal with con-
straints on integers, which are extremely common. The
classical Gauss ball problem tells us that VolZ(Bn
r ) is a
good approximation of Voln(Bn
r ) for large r, speciﬁcally
|VolZ(Bn
r ) − Voln(Bn
Theorem 4. If X is deﬁnable in an o-minimal structure over
R, then mZ(X) = m(X).
Proof Sketch. For X ⊆ Rn, we deﬁne Z = (cid:83)
r>0{x ∈
R1+n | x = (r, y), y ∈ X ∩ Bn
r } ⊆ R1+n. The ﬁbers of Z
are given as Zr = {x ∈ Rn : (r, x) ∈ Z}, and we have that
Zr = X ∩ Bn
r . To see that, we ﬁrst choose y ∈ Zr, which
means (r, y) ∈ Z, which means y ∈ X ∩ Bn
r . On the other
hand, if y ∈ X ∩ Bn
r , then (r, y) ∈ Z, which means y ∈ Zr.
We next need a bit of terminology. For j > 0, the term
Vj(Zr) denotes the sum of the j-dimensional volumes of the
orthogonal projections of Zr on every j-dimensional coor-
dinate subspace of Rn, while V0(Zr) = 1. It is well deﬁned,
since all these are deﬁnable in the o-minimal structure, and
bounded, and thus are Lebesgue-measurable.

Then (Barroero and Widmer 2014)[Theorem 1.3] says
that there is a constant cZ depending only on the family Z,
i.e. it can be chosen uniformly w.r.t. r, so that

(cid:12)
(cid:12) VolZ(Zr) − Voln(Zr)
(cid:12)

(cid:12)
(cid:12)
(cid:12) ≤ cZ ·

n−1
(cid:88)

j=0

Vj(Zr) = f (r)

(4)

Since cZ and n are constant, and diam(Zr) ≤ 2 · r, we have:

f (r) ≤ cZ + cZ ·

n−1
(cid:88)

j=1

(cid:19)

(cid:18)n
j

· (2 · r)n−j ≤ C · rn−1

(5)

where C is a constant that depends only on cZ and n. Hence,
f (r) ∈ O(rn−1). From the existence theorem in Section 3,
we know that m(ϕ) exists. Therefore, it is enough to show

lim
r→∞

|mZ

r (ϕ) − mr(ϕ)| = 0 .

(6)

We just showed that there is a constant c1 for which we have
that for all large enough r > 0:

|VolZ(Zr) − Voln(Zr)| ≤ c1 · rn−1

(7)

Also, from (Kr¨atzel 1988), we know that there is a constant
c2 for which we have that for all large enough r > 0:

|VolZ(Bn

r ) − Voln(Bn

r )| ≤ c2 · rn−1

(8)

the

Now, we make
following
distinction:
VolZ(Zr)θ1Voln(Zr) and VolZ(Bn
r ), where
each of θ1 and θ2 is either ≤ or ≥. In each of those it is easy
to prove (6).

case
r )θ2Voln(Bn

6 Computational aspects
Computing m(ϕ) is often a challenging task. Even for the
very simple language of quantiﬁer-free ﬁrst order formulae
over (cid:104)R, <(cid:105), it is complete for #P (the class of problems that
ask for the number of accepting paths of an NP machine),
see (Console, Hofer, and Libkin 2019). Problems hard for
#P are intractable, unless P = NP (Arora and Barak 2009).
As we go to slightly more expressive languages, computing
m(ϕ) becomes even more challenging: for every formula ϕ
of the form αx ≤ y, with α (cid:54)∈ {0, ±1}, m(ϕ) is irrational.

Thus we look at approximating m(ϕ) for ϕ deﬁnable in
logical theories over R with familiar arithmetic functions.
The only known result of this kind is for a very syntactically
restricted subclass of formulae over (cid:104)R, +, <(cid:105), i.e., linear
constraints on the reals. We now provide two different ways
of approximating m(ϕ) for much larger classes of functions,
without syntactic restrictions on the shape of the formulae.
The ﬁrst of those shows that, for FO formulae ϕ over
(cid:104)R, +, ·, <(cid:105), an approximation of m(ϕ) is deﬁnable in the
same structure. Thus, existing decision procedures can be
used to approximate m(ϕ). The size of M ε
ϕ(x) grows very
fast however. To overcome this, we present an efﬁcient ran-
domized approximation algorithm for m(ϕ), provided that
ϕ satisﬁes some mild conditions. These conditions capture,
e.g., Boolean combinations of polynomial inequalities.

Deﬁnability and Deterministic Approximation
We now focus on FO formulae over (cid:104)R, +, ·, <(cid:105). We assume,
as was already mentioned earlier, that the logical language
has a constant symbol for each r ∈ R. This preserves o-
minimality and many other properties of (cid:104)R, +, ·, <(cid:105). Since
(cid:104)R, +, ·, <(cid:105) is o-minimal, every parameterized deﬁnable
family over it has ﬁnite VC dimension, see (Dries 1998)
(this is what we used earlier to prove the existence result for
m(ϕ)). Using this property, we will show that, for every FO
formula ϕ over (cid:104)R, +, ·, <(cid:105), written ϕ ∈ FO((cid:104)R, +, ·, <(cid:105)),
and for every ε > 0, there exists an ε-approximation formula
M ε
• If M ε
• If |m − m(ϕ)| < ε/4, then M ε
Assume that ϕ(¯x) has n free variables. Deﬁne the set
Ult(Bn
r (¯c), ϕ) that contains all the points in the r-ball
around ¯c that ultimately satisfy ϕ as deﬁned in Section 4:

ϕ(m) is true, then |m − m(ϕ)| < ε; and

ϕ(x) that satisﬁes two conditions:

ϕ(m) is true.

Ult(Bn

r (¯c), ϕ) = {¯a | ¯a ∈ Br,¯c and ∃r0∀r > r0 ϕ(r · ¯a)}

We can then characterize m(ϕ) as follows:

m(ϕ) =

Vol(Ult(Bn
r (¯c), ϕ))
Vol(Bn
r )

.

(9)

Observe also that Ult(Bn
r (¯c), ϕ) is deﬁnable itself by a for-
mula denoted by Uϕ(¯x). Fix r = 1/2 and ¯c = (1/2)n, then
r (¯c), ϕ) ⊆ [0, 1]n. Using the results in (Karpinski and
Ult(Bn
Macintyre 1997; Koiran 1995) discussed in Section 3, we
can conclude that there exists an ε-volume approximation
ϕ (x) ∈ FO((cid:104)R, +, ·, <(cid:105)) of Ult(Bn
V ε
With V ε

ϕ (x) in place, to deﬁne an ε-approximation of
m(ϕ) we need a formula that deﬁnes Vol(Bn
). Assume
n ≥ 0, the volume of Bn
is equal to bn = q · πn, for some
q ∈ Q, and thus it is a term in FO((cid:104)R, +, ·, <(cid:105)) since we
have all elements of R as constants. Then deﬁne
ϕ (v) ∧ x = (v/bn)(cid:1)

ϕ(x) = ∃v (cid:0)V ε

r (¯c), ϕ).

M ε

(10)

1
2

1
2

Next, we prove that M ε
ϕ(x) is an ε-approximation of m(ϕ).
Theorem 5. For every ϕ ∈ FO((cid:104)R, +, ·, <(cid:105)) and every ε0 ∈
[0, 1], the formula M ε
ϕ(x) in (10), with ε = ε0 · bn, is an ε0-
approximation of m(ϕ).

Proof sketch. With r = 1
volume approximation of Ult(Bn
from x = (v/bn) and (9).

2 and ¯c = ( 1

2 )n, V ε

ϕ (v) is an ε-
r (¯c), ϕ). The result follows

Can we use M ε

ϕ(x) to compute m(ϕ) approximately?
To answer this question, we examine the size of M ε
ϕ(x)
for quantiﬁer-free formulae over (cid:104)R, +, ·, <(cid:105), i.e., Boolean
combinations of polynomial equalities and inequalities.
Theorem 6. Let ϕ(¯x) be the Boolean combination of s poly-
nomial inequalities of degree at most d, and n = |¯x|. The
formula M ε
ϕ(x), with ε = ε0 · bn, is of the form ∃∗∀∗∃∗∀∗α
where the number of quantiﬁers is:
• logarithmic in s and d;
• polynomial in 1/ε0;
• exponential in n;

and the size of the quantiﬁer-free formula α is
• logarithmic in d
• polynomial in s and in 1/ε0;
• exponential in n.

The long and routine proof of Theorem 6 consists of ap-
plying the construction of (Karpinski and Macintyre 1997)
and VC dimension bounds over the real ﬁeld (Goldberg and
Jerrum 1995).

Theorem 6 tells us that the number of quantiﬁers and the
size of M ε
ϕ(x) grow very fast, in fact exponentially, in the
size of ϕ. Also, to compute m(ϕ) via M ε
ϕ(x), we need to
run a (super-polynomial) quantiﬁer-elimination procedure
for (cid:104)R, +, ·, <(cid:105). Thus, while giving us a deterministic ap-
proximation algorithm, the technique cannot be realistically
applied except to very simple formulae. Thus, we turn our
attention to randomized procedures.

Absolute Error Approximation Scheme
When a function is hard to compute, a natural way to deal
with it is via approximation schemes. Roughly, an approx-
imation scheme for a function f (¯x) is an an algorithm that
can compute f (¯x) efﬁciently, within an input level of preci-
sion. In this section, we focus on functions mL, i.e., func-
tions m(ϕ), for some ﬁxed language L of functions and
predicates over R.

There are many different approaches to approximation
schemes (Vazirani 2001), all giving different kinds of guar-
antees on the output. Here we we deal with absolute error
fully polynomial randomized approximation schemes (AF-
PRAS). An AFPRAS for a function f : A → B is an algo-
rithm that takes as input a ∈ A and a value ε ∈ (0, 1] and, in
time polynomial in the size of a and the value ε−1, outputs
a random variable A(ϕ, ε) with the following guarantees:

Prob(|A(ϕ, ε) − f (a)| ≤ ε) ≥

3
4

AFPRASs are a popular way to deal with functions that are
hard to compute, especially when the range of these func-
tions lies in [0, 1] (Arora and Barak 2009). Another way
to deal with hard functions is via relative error fully poly-
nomial randomized approximation schemes (FPRASes). An
FPRAS for a function f : A → B is an algorithm that takes
as input a ∈ A and a value ε ∈ (0, 1], and outputs, in time
polynomial in the size of a and the value ε−1, a random vari-
able A(ϕ, ε) with the property that Prob(|A(ϕ, ε) − f (a)| ≤
f (a) · ε) ≥ 3
4 . Under reasonable complexity-theoretic as-
sumptions however it can be shown that there exists no
FPRAS for mL, even when L is the language of quantiﬁer-
free formulae over (cid:104)R, <(cid:105), see (Console, Hofer, and Libkin
2019).

We now present a technique to obtain an AFPRAS for
mL where L consists of functions and predicates so that the
structure on the reals given by them is o-minimal (e.g., the
usual arithmetic +, −, ·, ÷, <). Suppose that there exists an
algorithm Sample(ϕ) that, with input an n-ary formula ϕ ∈
L, outputs a Bernoulli random variable U such that

Prob(U = 1) =

Voln−1(Ult(ϕ))
Voln−1(Sn−1)

From Theorem 2 in Section 4, we know that Prob(U = 1) =
m(ϕ), and therefore the expected value E[U] is equal to
m(ϕ). To obtain an approximation for m(ϕ) then, we can use
the following standard statistical technique. Let U1, . . . , Un
be n independent Bernulli random variables, and deﬁne a
new random variable Mn = ((cid:80)n
i=1 Ui)/n. By Hoeffding’s
inequality (Blum, Hopcroft, and Kannan 2020) we then get
Prob(|Mn − E[U]| ≤ ε) ≥ 1 − 2−2nε2
Consider now the algorithm Apx(ϕ, ε) that, for input ϕ ∈ L
and ε ∈ (0, 1], computes the mean of n ≥ ε−2 executions
of Sample(ϕ), for the algorithm Sample given below. From
(11), we conclude

(11)

Prob(|Apx(ϕ, ε) − m(ϕ)| ≤ ε) ≥

3
4

(12)

Hence, Apx is an AFPRAS for mL as long as ¯a ∈ Ult(ϕ)
can be tested efﬁciently.

Algorithm 1 Sample

Input: An n-ary ϕ(¯x) ∈ L
Output: either 0 or 1
Pick ¯c uniformly at random from Sn−1
if ¯c ∈ Ult(ϕ) then
return 1

else

return 0

end if

Lemma 3. Let A be an o-minimal structure over R. For
every FO formula ϕ over A, Sample(ϕ) outputs a Bernulli
random variable such that E[Sample(ϕ)] = m(ϕ). More-
over, if ¯a ∈ Ult(ϕ) can be tested in time polynomial in ϕ,
then Sample(ϕ) runs in time polynomial in the size of ϕ.

Proof Sketch. Since Sample(ϕ) outputs a Bernulli random
variables, E[Sample(ϕ)] = Prob(Sample(ϕ) = 1). Since
¯c has been picked according to a uniform distribution over
Sn−1, the latter is equal to Voln−1(Ult(ϕ))
Voln−1(Sn−1) = m(ϕ). For
the complexity, observe that we can sample uniformly at
random from Sn−1 in time polynomial in n − 1 (Blum,
Hopcroft, and Kannan 2020).

Summing up, these results give us the following.

Theorem 7. Let L be a language giving rise to an o-minimal
structure over R. If there exists an algorithm that checks
whether ¯a ∈ Ult(ϕ) in time polynomial in the size of ϕ,
then there exists an AFPRAS for mL.

6.1 Asymptotic Satisfaction Oracles
The missing ingredient in Theorem 7 that gives us an AF-
PRAS is the ability to test ¯a ∈ Ult(ϕ) efﬁciently. This con-
dition is related to the existence of an efﬁcient oracle of the
following kind.
Deﬁnition 2. An Asymptotic Satisfaction Oracle (ASO) for
a structure A over R is a procedure Asym deﬁned as follows.
For every n-ary FO atomic formula α(¯x) over A and every
point ¯a ∈ Rn

• Asym(α, ¯a) = 1, if there exists r0 ∈ R such that for every

r ≥ r0 the formula α(r · ¯a) is true;

• Asym(α, ¯a) = 0, otherwise.

A structure A admits a polynomial-time Asymptotic
Satisfaction Oracle whenever
there exists a procedure
Asym(α, ¯a) such that Asym(α, ¯a) is an ASO for A and
Asym(ϕ, ¯a) runs in time polynomial in the size of the in-
put formula α. Whenever A is o-minimal and admits a
polynomial-time Asymptotic Satisfaction Oracle, we can de-
vise an efﬁcient algorithm to check whether a point ¯a ∈ Rn
lies inside Ult(ϕ).
Lemma 4. Let A be an o-minimal structure over R that has
the operation of multiplication. If there exists an ASO for A,
there exists an algorithm that checks whether ¯a ∈ Ult(ϕ) in
time polynomial in the size of ϕ, for every quantiﬁer-free FO
formula ϕ over A and ¯a ∈ Rn.

This immediately gives us the following:

Theorem 8. Given an o-minimal structures A over R
that has the operation of multiplication, if there exists a
polynomial-time ASO for it, then there exists an AFPRAS
for computing m(ϕ) for quantiﬁer-free formulae over A.

We conclude by showing that there is an AFPRAS com-
puting m(ϕ) for arbitrary linear and polynomial constraints
over R. The only previously known approximation result
was for linear constraints in disjunctive normal form, which
used the syntactic shape in an essential way. We now elimi-
nate syntactic restrictions, and allow multiplication and thus
conditions of the form p(¯x) ≤ 0 where p is a polynomial.
Theorem 9. There exists a polynomial
time ASO for
(cid:104)R, +, ·, <(cid:105). Consequently, there is an AFPRAS comput-
ing m(ϕ) for arbitrary Boolean combinations of linear and
polynomial equalities and inequalities over R.

Proof idea. Given constraint p(¯x) ≤ 0 and direction ¯a, to
check the asymptotic behavior of p in direction ¯a we replace
p by a univariate polynomial p(cid:48)(r) = p(r · ¯a) and check its
leading coefﬁcient.

7 Conclusions and Future Work
There are two main directions for further study. One con-
cerns applications of our techniques in areas mentioned
in the introduction: answering queries over incomplete
databases, temporal reasoning, spatial reasoning, etc. They
key is to see how well the sampling algorithm, that has good
theoretical guarantees, behaves in real-life scenarios.

The second idea is to extend techniques to cases when
m(X) does not exist due to the oscillating behavior of
mr(X) as a function of r. In this case one could deﬁne an
interval measure
m∗(X) = [lim inf r→∞(mr(X)), lim supr→∞(mr(X))] .
This is well deﬁned since sets {mr(X) | r > 0} are
bounded. An example provided in (Console, Hofer, and
Libkin 2019) to prove that m(X) may not be deﬁned out-
side o-minimal structures gave a speciﬁc set X deﬁned by a
quantiﬁer-free formula using sin(x) and ln x such that (ap-
proximately) m∗(X) = [0.00012, 0.06366]. While not an

Imielinski, T., and Lipski, W. 1984. Incomplete information
in relational databases. Journal of the ACM 31(4):761–791.
Karpinski, M., and Macintyre, A. 1997. Approximating the
In Structures in Logic
volume of general Pfafﬁan bodies.
and Computer Science, A Selection of Essays in Honor of
Andrzej Ehrenfeucht, 162–173.
Koiran, P. 1995. Approximating the volume of deﬁnable
sets. In FOCS, 134–141. IEEE Computer Society.
Kontchakov, R.; Pratt-Hartmann, I.; and Zakharyaschev, M.
2010. Interpreting topological logics over euclidean spaces.
In KR.
Koutras, C. D.; Liaskos, K.; Moyzes, C.; and Rantsoudis,
C. 2018. Default reasoning via topology and mathematical
analysis: A preliminary report. In KR, 267–276.
Kr¨atzel, E. 1988. Lattice Points. Kluwer.
Lenzerini, M. 2002. Data integration: a theoretical perspec-
tive. In ACM Symposium on Principles of Database Systems
(PODS), 233–246.
Libkin, L. 2016a. Certain answers as objects and knowl-
edge. Artif. Intell. 232:1–19.
Libkin, L. 2016b. SQL’s three-valued logic and certain an-
swers. ACM Trans. Database Syst. 41(1):1:1–1:28.
Libkin, L. 2018. Certain answers meet zero-one laws. In
PODS, 195–207.
Mattila, P. 1995. Geometry of Sets and Measures in Eu-
clidean Spaces. Cambridge University Press.
Van den Dries, L. 1998. Tame Topology and o-minimal
Structures, volume 248. Cambridge university press.
Vazirani, V. V. 2001. Approximation algorithms. Springer.
Wilkie, A. J. 1996. Model completeness results for expan-
sions of the ordered ﬁeld of real numbers by restricted Pfaf-
ﬁan functions and the exponential function. Journal of the
American Mathematical Society 9(4):1051–1094.

exact number, it is a small interval nonetheless. It is how-
ever far from clear, and far from trivial, to see how large
these intervals can be if the usual arithmetic is supplement
with oscillating functions such as sin(x).

More generally though these intervals can be arbitrar-
ily large, even for structures with nicely behaving the-
ories over integers. Consider for example the structure
(cid:104)N, +, 2x(cid:105). By Semenov’s theorem it is decidable and ad-
mits quantiﬁer-elimination, but it is easy to see that for X =
(cid:83)
] we have m∗(X) = [0, 1]. Understanding
when we can ﬁnd a bound on the measure of sets which is a
small interval, as well as algorithmic consequences of it, is
left for further work.

, 222k+1

k[222k

8 Acknowledgements
Work partially supported by EPSRC grants M025268,
N023056, and S003800.

References
Anthony, M., and Biggs, N. 1992. Computational Learning
Theory. USA: Cambridge University Press.
Arora, S., and Barak, B. 2009. Computational Complexity -
A Modern Approach. Cambridge University Press.
Barroero, F., and Widmer, M. 2014. Counting lattice points
International Mathematics Re-
and o-minimal structures.
search Notices 2014(18):4932–4957.
Belegradek, O. V.; Peterzil, Y.; and Wagner, F. 2000. Quasi-
o-minimal structures. J. Symb. Log. 65(3):1115–1132.
Bienvenu, M., and Ortiz, M. 2015. Ontology-mediated
query answering with data-tractable description logics.
In
Reasoning Web, 218–307.
Blum, A.; Hopcroft, J.; and Kannan, R. 2020. Foundations
of data science. Cambridge University Press.
Console, M.; Hofer, M.; and Libkin, L. 2019. Measuring the
likelihood of numerical constraints. In Kraus, S., ed., IJCAI,
1654–1660. ijcai.org.
Dechter, R.; Meiri, I.; and Pearl, J. 1991. Temporal con-
straint networks. Artiﬁcial Intelligence 49(1):61 – 95.
Dries, L. V. D. 1998. Tame topology and o-minimal struc-
tures, volume 248. Cambridge university press.
Egenhofer, M. J., and Franzosa, R. D. 1991. Point set topo-
logical relations. International Journal of Geographical In-
formation Systems 5(2):161–174.
Feng, S.; Huber, A.; Glavic, B.; and Kennedy, O. 2019. Un-
certainty annotated databases - A lightweight approach for
approximating certain answers. In SIGMOD, 1313–1330.
Godoy, F., and Rodr´ıguez, A. 2002. A quantitative descrip-
tion of spatial conﬁgurations. In Advances in Spatial Data
Handling. Springer. 299–311.
Goldberg, P. W., and Jerrum, M. 1995. Bounding the vapnik-
chervonenkis dimension of concept classes parameterized
by real numbers. Machine Learning 18(2-3):131–148.
Greco, S.; Molinaro, C.; and Trubitsyna, I. 2019. Approx-
imation algorithms for querying incomplete databases. Inf.
Syst. 86:28–45.

