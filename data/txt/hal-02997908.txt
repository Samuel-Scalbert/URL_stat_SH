How to use Model Checking for Diagnosing Fault
Patterns in Petri nets
Johanne Bakalara, Yannick Pencolé, Audine Subias

To cite this version:

Johanne Bakalara, Yannick Pencolé, Audine Subias. How to use Model Checking for Diagnosing Fault
Patterns in Petri nets. WODES 2020 - 15th IFAC Workshop on Discrete Event Systems, Nov 2020,
Virtual, Brazil. pp.1-6. ￿hal-02997908￿

HAL Id: hal-02997908

https://hal.science/hal-02997908

Submitted on 10 Nov 2020

HAL is a multi-disciplinary open access
archive for the deposit and dissemination of sci-
entific research documents, whether they are pub-
lished or not. The documents may come from
teaching and research institutions in France or
abroad, or from public or private research centers.

L’archive ouverte pluridisciplinaire HAL, est
destinée au dépôt et à la diffusion de documents
scientifiques de niveau recherche, publiés ou non,
émanant des établissements d’enseignement et de
recherche français ou étrangers, des laboratoires
publics ou privés.

Distributed under a Creative Commons Attribution - NonCommercial - NoDerivatives 4.0
International License

15th IFAC Workshop on Discrete Event Systems
November 11-13, 2020. Rio de Janeiro, Brazil

Copyright © 2020 the authors. Accepted by IFAC for
publication under a Creative
Commons License CC-BY-NC-ND.

269

HowtouseModelCheckingforDiagnosingFaultPatternsinPetrinetsJohanneBakalara∗YannickPencol´e∗AudineSubias.∗∗LAAS-CNRS,Universit´edeToulouse,CNRS,INSA,Toulouse,France(ypencole@laas.fr,subias@laas.fr).Abstract:ThispaperdealswiththeproblemoffaultpatterndiagnosisindiscreteeventsystemsmodelledbyPetrinets.Ageneralframeworkforimplementingapatterndiagnosisfunctionbymodel-checkingisproposed.Twodiﬀerentapproacheswithexperimentalresultsarepresentedandcomparedtoathirdapproachfromtheliterature.Keywords:Diagnosis,modelchecking,faultpatterns,Petrinet,LinearTimeLogic1.INTRODUCTIONTheoriginalproblemofdiagnosisindiscreteeventsystemsasintroducedinSampathetal.(1995)istodeterminetheoccurrenceofafaultinasystem,thefaultbeingmodelledbyasingleevent.Inthiswork,ourobjectiveistoconsiderthediagnosisofafaulteventbutalsothediagnosisofmorecomplexfaultybehaviours(calledfaultpatterns)thatcan-notbemodelledbyasimpleevent(seeJ´eronetal.(2006),BoussifandGhazel(2018)).Indeed,forsomesystems,achangeintheorderofoccurrenceoftheevents,orthejointoccurrenceofspeciﬁcevents,orthemultipleoccurrenceofaspeciﬁctypeofeventmayreﬂectafaultybehaviour.ThispaperaddressesthepatterndiagnosisproblemthathasbeenintroducedinPencol´eandSubias(2017)forPetrinets.Theobjectiveistoinvestigateseveralmannerstosolvetheproblemthatusemodel-checkingtechniques(Clarkeetal.(1999)).Theadvantagesofmodelcheckingmethodsarenumerous:speed,noproofbuilding,manylogicsallowingtoexpresslargenumbersofproperties,gen-erationofcounter-examples.Model-checkinghasbeenwellstudiedformanyyearsandmanytechniquesareusedtocounterthemainobstacleofthecombinatorialexplosion(e.g.abstraction,symmetries,reduction).Theobjectiveofthisarticleistoconsiderarangeofapproachesbasedonmodelcheckingtosolvethepatterndiagnosisproblemandtocomparetheiradvantagesanddrawbacks.Theproposedapproachessolvethesameproblembutdiﬀerinthewaytheyrepresentthethreeelementsthatdeﬁneadiagnosisproblem:thesystem,thefaultybehaviourandthesequenceofeventsobserved.Thepaperisorganizedasfollows.TheproblemstatementispresentedinSection2followedbythedescriptionofthegeneralmethodtosolvethepatterndiagnosisproblemwithamodel-checkingapproach.Section3thenpresentsaﬁrstmethodinwhichthefaultybehaviourandtheobservationsaredirectlyexpressedasacomplexpropertytobeveriﬁedinthesystem’smodel.AﬁrstseriesofexperimentalresultsarethenpresentedinSection4andcomparedwithamethodproposedinPencol´eandSubias(2017).Basedontheseresults,asecondapproachisproposedinSection5andcomparedwiththeothers.Finally,conclusionsandsomeperspectivesaregiveninSection6.2.PROBLEMSTATEMENTThesystemismodeledasaclassicalboundedlabeledPetrinet,denotedLPN(possiblywithtransitionprior-itiesandarcinhibitors):somelabelsrepresentobserv-ableevents(Σo={o1,...,op})andtheothersrepresentsilent/unobservableevents(Σu={uo1,...,uom}).Arunofthesystemisasequenceofﬁredtransitionsfromaninitialmarkingandgeneratesawordρ∈(Σu∪Σo)∗.Now,givenasequenceofobservedeventsfromthesystem,denotedσ∈Σ∗o,theΩ-diagnosisproblemconsistsindeterminingwhetheranunobservablepatternofeventsΩhasoccurredornot.ApatternofeventsΩdenotesacomplexassemblingofevents(asetofwordsfromΣ∗u)andwesaythatΩhasoccurredinaruniftherungeneratesawordρthatcontainsasasubwordoneofthewordsofΩ(seePencol´eandSubias(2017)formoredetails).Tosolvethisproblem,theobjectiveistodesignadiagnosisfunction∆thatreturnsoneofthethreeresults:ΩFaultyifthepatternhascertainlyoccurred(anyrunofthesystemthatgeneratesσisarunwhereΩoccurred),ΩAbsentifthepatterniscertainlyabsent(norunofthesystemthatgeneratesσisarunwhereΩoccurred)andΩAmbiguousotherwise.Inthispaperweinvestigateseveralapproachestodesign∆byusingamodel-checkingtoolcalledTINA(TImepetriNetAnalyzerhttp://www.laas.fr/tina/)thatisabletocheckpropertiesoverLPNandcomparethemwiththeoneofPencol´eandSubias(2017).2.1BackgroundonmodelcheckingAmodel-checkingproblemconsistsincheckingwhethersomegivenstates(orruns)ofaformalmodelMsat-isfyagivenpropertyφencodedinaformulaofsometemporallogic(Clarkeetal.(1999)).Amodel-checkingtoolchecksifMsatisﬁesφ(denotedM|=φ)i.eifφistrueinalltheworldsofM.Todoso,onesolutionistheautomatabasedapproachofmodel-checking.InthiscasetheproblemistranslatedtoalanguageintersectionproblembyconvertingMand¬φasB¨uchiautomata.TheB¨uchiautomatonofMgeneratestheinﬁnitelylongwordsofLω(M)describingthesetofrunsofMwhiletheB¨uchiautomatonof¬φgeneratestheinﬁnitelylongIFAC WODES 2020
November 11-13, 2020. Rio de Janeiro, Brazil

270

wordsofLω(¬φ)where¬φholds.Themodel-checkerthenchecksforL(M)∩L(¬φ)=∅.Iftheintersectionisempty,thenM|=φ,otherwiseM(cid:54)|=φandacounterexampleisreturnedasawordofL(M)∩L(¬φ).Lineartemporallogic(LTL)canbeusedtoexpressthepropertiessothattheirstatementscaneasilybetransformedinautomata.TINAisamodel-checkingtoolthatconvertsanyLPNintoaspeciﬁcenrichedKripkestructureM(Berthomieuetal.(2004),Berthomieuetal.(2007))andcheckspropertiesφthatarewritteninState/EventLTL(SE-LTL)logic.AformulaφisaSE-LTLformulaifitisauniversallyquantiﬁedformulaφ::=∀ϕwhereϕ::=cst|r|¬ϕ|ϕ∨ϕ|ϕ∧ϕ|(cid:13)ϕ|(cid:3)ϕ|♦ϕ|ϕ(cid:116)ϕ.Theconstantcstcanbe⊥(false),(cid:62)(true),dead(deadlock),div(temporaldiver-gence),sub(partiallyknownstate).rdenotesconstraintse(cid:52)ewith(cid:52)∈{=,<,>,≤,≥}betweenarithmeticalexpressionseinvolvingplaceandtransitionsymbolsfromtheunderlyingLPN.Finally,modaloperators(cid:13),(cid:3),♦,(cid:116)arerespectivelytheoperatorsnext,always,eventuallyanduntil.SE-LTLexpressesformulasaboutplacesandtran-sitionsofPetrinets,however,allalongthepaper,wewillexpressSE-LTLformulaswitheventsfromΣu∪Σo.Aneventebeingthelabelofoneorseveraltransitionst1,...,tnofthenet,bywritingeinanyofthefollowingformulaweactuallywritetheunderlyingSE-LTLformula(t1∧¬(t2∨···∨tn))∨(t2∧¬(t1∨t3···∨tn))∨...thatassertsthatone(andonlyone)transitionlabeledwitheisﬁred.2.2Generalprincipleforimplementingadiagnosisfunctionbymodel-checkingAlgorithm1describesthegeneraldiagnosisalgorithmimplementingthediagnosisfunction∆bymodel-checking.MdenotestheformalmodelthatisinvestigatedwhileΨ¬ΩisaSE-LTLformulacorrespondingtothequestion:arewesurethatpatternΩneveroccurredinarunconsistentwiththeobservationsequenceσ?Iftheresultistrue,∆canimmediatelyreturnsΩAbsent.Ifnot,anewquestionΨΩisasked:arewesurethatΩalwaysoccurredinallthesequencesconsistentwithσ?Iftheresultistrue,∆canreturnΩFaulty,otherwisewearesurethereisanambiguity(∆returnsΩAmbiguous).Algorithm1Diagnosisalgorithm∆bymodel-checking1:ifM|=Ψ¬Ωthen2:return∆(σ)=ΩAbsent3:elseifM|=ΨΩthen4:return∆(σ)=ΩFaulty5:else6:return∆(σ)=ΩAmbiguous7:endifAlgorithm1isactuallyanalgorithmtemplateaswehavenotyetdeﬁnedwhatisM,Ψ¬ΩandΨΩ.Thenextsectionsproposediﬀerentmethodsandcomparethem.3.APUREMODEL-CHECKINGAPPROACHThissectionpresentsamethodthatiscalledpuremodel-checkingapproach(denotedPUREforshort).ItiscalledpureinthesensethatthemethodaimsatfullyencodingthepatterndiagnosisproblemwiththequestionsΨΩandΨ¬ΩbasedonthemodelofthesystemthatisencodedwithM.Thereareactuallytwosubproblemstosolve.Theﬁrstoneis:whataretherunsofthesystemthatareconsistentwithσ?Thesecondoneis:amongtheseruns,whataretheoneswhereΩhasoccurredandtheoneswhereithasnot.ThetwoformulaeΨ¬Ω(absenceofΩ)andΨΩ(occurrenceofΩ)arethenasbelow:(cid:40)Ψ¬Ω:Φσ⇒Φ¬ΩΨΩ:Φσ⇒ΦΩ(1)ΦσisthepartoftheformulathatexpressesthatanyrunofinterestsinthequestionisconsistentwiththeobservationsequenceσwhileΦ¬Ω(resp.ΦΩ)expressesthatΩhasnotoccurredinanyrun(resp.Ωhasoccurredinanyrun).ItfollowsthatΨ¬ΩistrueeitherifΩdoesnotoccurinanyrunconsistentwithσorifthereisnorunconsistentwithσ.ForΨΩ,intheremainderitissupposedthattheobservedsequenceiscorrectandthatitalwaysexistsatleastoneruninthemodelofthesystemthatisconsistentwiththeobservationσ.Therefore,ΨΩistrueifΩoccursinanyrunconsistentwithσ.3.1DeﬁnitionofΦσLetusconsidernowtherepresentationoftheobserva-tionsequenceσintheSE−LTLformula(Φσ).Wede-noteNOEthedisjunctionofalltheunobservableevents,NOE=(cid:87)1≤i≤muoi=uo1∨uo2...∨uomwithNOE=(cid:62)ifthesetisempty.Anobservationsequenceσ=o1o2canbedescribedbythefollowingformula:NOE(cid:116)(o1∧(cid:13)(NOE(cid:116)o2)).Inotherwords,anobservationsequenceisatraceincludingsomeunobservableevents(NOE)until((cid:116))anobservableevento1andthisevento1isdirectlyfollowed((cid:13))byunobservableevents(NOE)until((cid:116))o2.NotethattheUntiloperator(a(cid:116)b)acceptsthetracesthatsatisfyauntilbbutalsonothingbeforeb.So,ifnounobservableeventoccursbetweenthetwoobservedeventso1ando2inarun,thispropertyholdsintherun.Inthegeneralcaseanobservationsequenceσofk=|σ|eventsisthenrecursivelygivenbyΦσ=ϕ1withϕnfornfrom(k−1)to1suchthat:(cid:26)ϕk=NOE(cid:116)okϕn=NOE(cid:116)(on∧(cid:13)(ϕn+1))(2)Letusconsiderσ=o1o2o3,ϕ1isgivenby:ϕ3=NOE(cid:116)o3ϕ2=NOE(cid:116)(o2∧(cid:13)(ϕ3)))=NOE(cid:116)(o2∧(cid:13)(NOE(cid:116)o3)))ϕ1=NOE(cid:116)(o1∧(cid:13)(ϕ2)))=NOE(cid:116)(o1∧(cid:13)(NOE(cid:116)(o2∧(cid:13)(NOE(cid:116)o3))))))thenΦσ=ϕ1=NOE(cid:116)(o1∧(cid:13)(NOE(cid:116)(o2∧(cid:13)(NOE(cid:116)o3)))))).3.2DeﬁnitionsofΦΩ,Φ¬Ω:thesinglefaultcaseWeconsiderﬁrstthesinglefaultcase:Ωistheoccurrenceofasinglefaultf∈Σu.TodeﬁneΦf,Φ¬f,weneedtodistinguishtwocases:diagnosisproblemwithorwithoutsilentclosure(introducedinLampertiandZanella(2003)).InthecasethatthediagnoserdoesnotwanttoaddressIFAC WODES 2020
November 11-13, 2020. Rio de Janeiro, Brazil

271

thesilentclosureissue(i.e.thediagnosisfunctiondoesnotlookforwhatcouldhavehappenedafterthelastobservedeventofσ),onlyunobservableeventsoccurringbeforeorduringexecutionsthatareconsistentwiththeobservationsequenceσareconsidered.DiagnosiswithoutsilentclosureTocheckthatthefaulthasnotocurredinanyrun(i.eΦ¬f)itisnecessarytoexpressthatthefaultdoesnotoccurneitheratthebeginningoftheobservationnorbetweenobservableevents.NotethatatthisstageonlytherelevantrunsareconsideredduetothedoubleimplicationofEquation(1).Asanexampleletusconsideranobservationsequenceσ=o1o2,anyruninwhichΦ¬fholdsmustbesuchthatitdoesnotincludefuntil((cid:116))o1thatisfollowed((cid:13))bysomeeventsthatarenotfuntilo2.Thiscanbeexpressedby:(¬f(cid:116)(o1∧(cid:13)(¬f(cid:116)o2))).Fromthisexampleitappearsthattheformulacanbeexpressedinarecursivewaysuchthat:Φ¬f=ϕ1withϕnfornfrom(k−1)to1.(cid:26)ϕk=¬f(cid:116)okϕn=¬f(cid:116)(on∧(cid:13)(ϕn+1))(3)Letusconsidertheobservationsequenceσ=o1o2o3,ϕ1isthengivenrecursivelyby:ϕ3=¬f(cid:116)o3ϕ2=¬f(cid:116)(o2(∧(cid:13)(ϕ3)))=¬f(cid:116)(o2(∧(cid:13)(¬f(cid:116)o3)))ϕ1=¬f(cid:116)(o1(∧(cid:13)(ϕ2)))=¬f(cid:116)(o1(∧(cid:13)(¬f(cid:116)(o2(∧(cid:13)(¬f(cid:116)o3)))))ThenΦ¬f=¬f(cid:116)(o1(∧(cid:13)(¬f(cid:116)(o2(∧(cid:13)(¬f(cid:116)o3)))))NowletusdeﬁneΦf,weneedtoexpressthatthefaultmayappearbeforetheobservedeventsorbetweentheobservedevents.Letusconsiderasimplesequenceoftwoeventsσ=o1o2.AnyrunwhereΦfholdsmustincludeunobservableeventsdiﬀerentfromf(NOE/{f})untilfortheevento1directlyfollowedbyunobservableeventsdiﬀerentfromfuntilf:NOE/{f}(cid:116)(f∨(o1∧(cid:13)(NOE/{f}(cid:116)f))).Thiscanbeformalizedinarecursivewayby:Φf=ϕ1withϕnfornfrom(k−1)to1.(cid:26)ϕk=NOE/{f}(cid:116)fϕn=NOE/{f}(cid:116)(f∨(on∧(cid:13)(ϕn+1)))(4)Toillustratethisformulaletusconsiderσ=o1o2o3.ϕ3=NOE/{f}(cid:116)fϕ2=NOE/{f}(cid:116)(f∨(o2∧(cid:13)(ϕ3)))=NOE/{f}(cid:116)(f∨(o2∧(cid:13)(NOE/{f}(cid:116)f)))ϕ1=NOE/{f}(cid:116)(f∨(o1∧(cid:13)(ϕ2)))=NOE/{f}(cid:116)(f∨(o1∧(cid:13)(NOE/{f}(cid:116)(f∨(o2∧(cid:13)(NOE/{f}(cid:116)f))))))thenΦf=ϕ1=NOE/{f}(cid:116)(f∨(o1∧(cid:13)(NOE/{f}(cid:116)(f∨(o2∧(cid:13)(NOE/{f}(cid:116)f)))))).HowtodealwithsilentclosureByconsideringthesilentclosure,thediagnosermustnowalsotakeintoaccountthefactthatthefaultcanalsooccurafterthelastobservedevent.Tocheckthatthefaultisabsentallalongtherun,wethenneedtomodifyΦ¬f.LetOE=(cid:87)1≤i≤poi=o1∨o2...∨opbethedisjunctionofallobservableeventsfromΣo.Letusconsideranobservationsequenceσ=o1o2.TherunsthatwewanttocharacterizewithΦ¬fdonotincludethefaulteventfuntilo1,thatisfollowedbyunobservableeventsdiﬀerentfromfuntilo2,thatisfollowedbyunobservableeventsdiﬀerentfromfuntilanyobservableevent.Sobygeneralizing,theformulaΦ¬fisgiveninarecursivewayasΦ¬f=ϕ1withϕnfornfromkto1.(cid:26)ϕk+1=¬f(cid:116)OEϕn=¬f(cid:116)(on∧(cid:13)(ϕn+1))(5)SupposenowthatM|=Φσ⇒Φ¬fistrue,thediagnosisfunctionstopsandreturnsfAbsent(seeAlgorithm1).Ifitisnottrue,supposethatfoccursbeforethelastobservedeventineveryrunsuchthatΦσholds,thenwiththepreviousformulaΦf,M|=Φσ⇒Φfistrueand∆returnsfFaulty.Finally,ifthereisarun,suchthatΦσholds,inwhichfoccursonlyafterthelastobservedevent,thenthereisalsoarun,suchthatΦσholds,inwhichfdoesnotoccuratall(itisapreﬁxofthepreviousrun)sointhislastcase,∆mustreturnfAmbiguous.Therefore,theformulaΦfremainsunchangedwhendealingwithsilentclosure,onlyΦ¬fismodiﬁed.3.3ExtensiontofaultclassdiagnosisWenowproposetoextendthispuremodel-checkingap-proachtodealwithaspeciﬁctypeofpatternscalledfaultclass.AfaultclassgathersasetofindependentfaulteventsdenotedF={f1,f2,..,fq}⊆Σu.FollowingAlgorithm1,thediagnosisprincipleistocheckﬁrstthatnofaultoftheclasshasoccurredinarunofthesystemconsistentwiththeobservationsequence.Iftheresultistrue(i.e.M|=Ψ¬F),thediagnosisresultisFAbsenti.eitissurethatthefaultclasshasnotoccurred.Otherwise,ifinanysystem’srunconsistentwiththeobservationsσ,atleastonefaultoftheclassFhasoccurred,thediagnosisresultisFFaulty.Finally,∆returnsFAmbiguousifthereareatleasttworunsconsistentwithσsuchthatonecontainsatleastafaultoftheclassFandtheotherrundoesnotcontainanyfaultoftheclass.FaultclassdiagnosiswithoutsilentclosureTheSE-LTLformulathatcheckstheabsenceofafaultclassissimilartotheoneproposedinthecaseofsimplefaultwherethesimplefaulteventfisreplacedbyFthatdenotesthedisjunctionofallthefaultsofF:F=(cid:87)f∈Ff.ThenΦ¬F=ϕ1withϕnfornfrom(k−1)to1.(cid:26)ϕk=¬F(cid:116)okϕn=¬F(cid:116)(on∧(cid:13)(ϕn+1))(6)FormulaΦFisalsoderivedfromthesimplecase(seeEquation(4)).ΦF=ϕ1withϕnfornfrom(k−1)to1.(cid:26)ϕk=NOE/F(cid:116)Fϕn=NOE/F(cid:116)(F∨(on∧(cid:13)(ϕn+1)))CaseofthesilentclosureFortheabsenceoffaultclasswiththesilentclosure,theIFAC WODES 2020
November 11-13, 2020. Rio de Janeiro, Brazil

272

formulaissimilartotheonegivenforthesimplefault(seeEquation(5))byreplacingtheeventfbyF.Tochecktheoccurrenceofthefaultclass,thesameformulaastheoneusedinthecasewithoutthesilentclosureisconsideredforthesamereasonasinthesimplefaultcase.4.FIRSTEXPERIMENTALRESULTSThissectiondescribessomeexperimentalresultsaboutthePUREapproachpresentedhereabove.TheseexperimentsareperformedontheexamplefromPencol´eandSubias(2017):aproducttransportationsystem.4.1ProducttransportationsystemTheproposedexampleisatwo-levelsystemcomposedoftwoproductsites(namelysites1and2)atlevel2whereasetofproductsisstoredandtwoassemblystationsatlevel1thatrequestproductsfromlevel2.Aliftisusedbetweenthetwolevels.Eachsitehasaconveyorbelttomoveaproductfromthesitetotheliftandeachstationalsohasaconveyorbelttogettheproductsfromthelift.Figure1presentsthesystemLPNmodel.Onceaproductisdetectedonthesite1,aProduct1signal(denotedPr1)isemitted.Theproductisthenputinaboxandbecomesavailable.Theboxisthenpushedandsentintothelift(actionPush1thatstartswitheventP1andendswitheventEP1).Site2behavesinasimilarmanner.Aproductfromsite1hasapriorityaccesstothelift.InthePetrinetmodelofFigure1,thispriorityrelationisindicatedbyadashededgebetweenthetransitionslabeledbyP1andP2.Afteraproducthasbeenpushedintothelift,theliftgoesdown(actionDown)toreachlevel1(signalDdetectstheendoftheDownaction).Atthisleveltheboxisdirectedtothestationthatmakestherequest(eitherrequestReq1orrequestReq2).IfitisrequestReq1,thentheboxispushedontheconveyorbeltofstation1(actionPushReq1thatstartswitheventReq1andendswitheventEPReq1).Thentheconveyorbeltperformsamove-leftaction(LeftReq1,ELReq1)todelivertheboxwiththeproductandamove-rightactiontogobacktoinitialposition(RightReq1,ERReq1).Thebehaviourofstation2issimilarexceptthatitsconveyorbeltmovesrightﬁrst(RightReq2,ERReq2)andthenmovesleft(LeftReq2,ELReq2).Oncetheboxhasbeenpushedonaconveyorbelt,theliftgoesup(actionUpendingwiththeemissionofsignalU)tolevel2.InFigure1onlyunderlinedeventsareobservableevents.4.2ResultsTheobjectiveinthisexperimentalsettingistodiagnosetheoccurrenceoftheeventReq1basedonσ:Pr1Pr2DUDERReq2ELReq2ELReq1ERReq1Ucomposedoftenobservableevents.Intheapproachthatwealreadydescribed,theKripkestructureMcomputedbyTINAdependsonlyonthesystemandhas204statesand625transitions.Table1presentstheresultsandanylinerepresentsonestepofthescenarioσ(i.eline1isPr1,line2isPr1followedbyPr2etc).Columns2and3indicaterespectivelytheanswerofthequestionarewesurethatthefaultneveroccurredonarunconsistentwiththeobservationsequence?(Ψ¬f)andarewesurethatfalwaysoccurredinanyrunconsistentwiththeobservationProd1Prod1Avail1Push1Pr1P1EP1Prod2Prod2Avail2Push2Pr2P2EP2WaitUpUpDownWaitDownUDWait1PushReq1LeftReq1RightReq1Req1EPReq1ELReq1ERReq1Wait2PushReq2RightReq2LeftReq2Req2EPReq2ERReq2ELReq2Fig.1.Casestudy:theproducttransportationsystemObs.Ψ¬fΨfDiagnosisTime(ms)Pr1TFAbsent32Pr2TFAbsent24DFFAmbiguous22UFFAmbiguous50DFFAmbiguous126ERReq2FFAmbiguous55ELReq2FFAmbiguous3189ELReq1FTFaulty25522ERReq1FTFaulty240524UxxxxTable1.FaulteventdiagnosiswithsilentclosureObs.Ψ¬fΨfDiagnosisTime(ms)Pr1TFAbsent12Pr2TFAbsent14DTFAbsent13UFFAmbiguous22DFFAmbiguous153ERReq2FFAmbiguous197ELReq2FFAmbiguous1076ELReq1FTFaulty7121ERReq1FTFaulty66799UxxxxTable2.Faulteventdiagnosiswithoutsilentclosuresequence?(Ψf).Column4givesthediagnosisconclusionandthelastcolumnisthecomputationtimesobtainedbyTINA.Table2presentstheresultsinthecasewithoutsilentclosure.Firstofall,basedonTable2,thePUREapproachgetsthesameresultsasforthemethodproposedinPencol´eandSubias(2017)(anddenotedPRODherebelow).Also,ifwecomparebothTables,wecanseethattheresultswiththesilentclosurearesometimesmoreambiguous(line3)whichisexplainedbythefactthatReq1mayoccurbetweentheoccurrenceofDandU.WithoutthesilentclosurethispossibleoccurrenceissimplyignoredIFAC WODES 2020
November 11-13, 2020. Rio de Janeiro, Brazil

273

(thediagnosisisAbsent)whilethediagnosisisAmbiguouswhenconsideringthesilentclosure.Nowregardingthecomputationtime,resultsshowthecomputationtimeisnotsatisfactoryasthecomputationtimeisexponentialwiththesizeoftheobservationsequenceandPRODclearlyoutperformsPURE.Adetailedanalysisofthesetofexperimentsindicatesthesourceofthecomplexityproblem.AsexplainedinSection2.1,onestepofthemodel-checkingisthecomputationofthelanguageL(¬Φ),thatistheconversionoftheformula¬ΦintoitsequivalentB¨uchiautomatonandthisconversionisunfortunatelyexponentialtothelengthofformulaΦ(i.e.O(2|Φ|))andso,byconstructionoftheformulaΨf,Ψ¬f(seeSection3),PUREisexponentialinthesizeofσ(O(2|Φ|)=O(2|σ|)).LookingnowatthePRODmethod,thislimitationisnotpresent.Indeed,evenifPRODfollowsthesamealgorithm(seeAlgorithm1),theinformationstoredinMandinΨΩ,Ψ¬Ωarefundamentallydiﬀerent.PRODreliesonasetofspeciﬁcproductsofLPNstogatherinonesingleLPNtheinformationabouthowapatternΩmatchesanysinglerunofthesystemandhowanysinglerunofthesystemisconsistentwithσ.ThesizeofMisinO(2|σ|)inPRODwhileinPUREthesizeofMdoesnotdependon|σ|.Secondly,inPROD,thequestionsΨΩ,Ψ¬ΩdonotdependonthesizeofσasopposedtotheonesfromPURE.AsopposedtoPROD,ourobjectiveistobeneﬁtoftheexpressivityofSE-LTLtowritepatternΩandnotasanLPNlikeinPROD.ToavoidthatΨΩandΨ¬Ωdependonthesizeofσ,weproposeatradeoﬀbetweenthePUREandPRODapproaches.TheideaistosynchroniseﬁrstthesystemmodelwiththeobservationsequenceσbyclassicaltransitionfusionasinPRODtoisolatetherunsofthesystemconsistentwiththeobservationsequence.TheresultofthissynchronisationisanLPNthatwouldbeconvertedasaKripkestructureM(inO(2|σ|)asinPROD)andΨΩ,Ψ¬Ωwouldonlycharacterizethepatternmatching(independentfromσ).5.ANAPPROACHOVERAMODELSYNCHRONISEDWITHTHEOBSERVATIONSThissectiondescribesthemodel-checkingapproachde-notedSYNthatisacompromisebetweenPUREandPROD.TheobservedsequenceσisthenmodeledbyaLPNOasasinglesequenceofplacesandtransitions.AsynchronisedproductbetweentheLPNofthesystemandtheLPNoftheobservationsequenceisperformedbasedontransitionfusions(seeHack(1975)).Figure2presentssuchasynchronisation.TheSYNapproachisstillgovernedbyAlgorithm1andtheformulaΨΩandΨ¬ΩstillfollowEquation(1).Butnow,asopposedwiththePUREapproach,andsimilarlytothePRODapproach,Ψσconsistsincheckingwhetherasystem’srunwilleventuallyleadtoamarkingwherepobsismarkedinthesynchronisedLPN(seeFigure2).ItfollowsthatintheSYNapproachΦσ=♦pobswhoselengthdoesnotdependon|σ|.5.1DiagnosisofafaulteventTheobjectiveistocheckthatnorunconsistentwiththeobservationscontainsthefaulteventfatthebeginningorbetweentwoobservedevents.TheformulaΦ¬fisthengivenby:Φ¬f=(cid:3)¬(f∧(cid:13)(♦(ok∧(cid:13)pobs))).Φ¬fassertsFig.2.σontheleft,thesystemontheright,thesynchro-nisationbelowthatfaultfneveroccurs((cid:3)¬)ifinthefuture((cid:13))1thesystemeventuallyleads(♦)totheﬁringofthelasteventofσ(ok∧(cid:13)pobs).Itisnecessarytoconsiderthesequenceuntilthelastobservedeventfollowedbypobsastheeventokisnotasuﬃcientconditionsincethesameeventcanbeobservedseveraltimesintheobservationsequence,soitsobservationdoesnotguaranteetheendoftheexecutionoftheobservationsequence.Moreoverpobsisalsonotsuﬃcientasitremainsmarkedaftertheexecutionoftheobservationswhereassomeunobservableeventscanoccurafterthelastobservation.TheformulaΦfisthengivenbyΦf=♦(f∧(cid:13)(♦(ok∧(cid:13)pobs))):itmeansthesystemwilleventually(♦)ﬁreffollowed((cid:13))byasetoftransitionstoendasarunthatisconsistentwithσ(ok∧(cid:13)pobs).UnlikethePUREmethod,Φfhasasizeindependentof|σ|.5.2DiagnosisofafaultclassandmultiplefaultsTheproblemoffaultclassdiagnosiscanalsobeconsideredbyreplacingtheeventfbyFthedisjunctionofallthefaultsoftheclassinthepreviousformulasΦ¬fandΦfasinthePUREmethod.Nowwemayalsobeinterestedinthediagnosisofmultiplefaults.SupposeforinstanceafaultclassF={f1,f2},themultiplefaultassociatedwithFistheoccurrenceoffaultf1andf2inthesamerun.Todiagnosesuchamultiplefault,theformulasΦ¬F,ΦFcanbeadapted:Φ¬F=(cid:3)¬(ϕ2)andΦF=ϕ2whereϕ2=♦(f1∧(cid:13)(♦(ok∧(cid:13)pobs))))∧(♦(f2∧(cid:13)(♦(ok∧(cid:13)pobs))).TheproblemcanbegeneralisedtoF={f1,f2,..,fq},thusΦ¬F=(cid:3)(¬(ϕq))andΦF=ϕqwhereϕqissuchthat(cid:26)ϕn=(ϕn−1)∧(♦(fn∧(cid:13)(♦(ok∧(cid:13)pobs))))ϕ1=(♦(f1∧(cid:13)(♦(ok∧(cid:13)pobs))))(7)5.3PatterndiagnosisWiththeSYNapproach,theproblemoffaulteventdiag-nosiscanbeextendedtothefaultpatterndiagnosisthataimsatdiagnosingmorecomplexfaultybehavioursoranynormalbehaviourofinterest(J´eronetal.(2006),Pencol´e1Thenextoperatorisusedtotraducethattheeventsfandokarenotsimultaneous,butitisnotmandatory.IFAC WODES 2020
November 11-13, 2020. Rio de Janeiro, Brazil

274

andSubias(2017)).Forinstanceapatterncandescribeasequenceofnunobservableevents:letusconsiderapatternΩ1correspondingtothesequencee1e2e3.IfΩ1occursinarunthentherunﬁrstleadstoe1followedinthefuturebye2thatisfollowedinthefuturebye3followedbythelastobservedeventfollowedbyendofsynchronisation:ΦΩ1=♦(e1∧(cid:13)(♦(e2∧(cid:13)(♦(e3∧(cid:13)(♦(ok∧(cid:13)pobs))))))).AndtheabsenceΩ1intherunischaracterizedbythenegation:Φ¬Ω1=(cid:3)(¬ΦΩ1).Thisapproachallowsalsotop0p1p2p3p4Req1Req1Req1Req2Req2Fig.3.PatternΩ2(3,2):2occurrencesof3requestsReq1.considermorecomplexbehaviourthatonemightwanttodiagnose.LetuscomebacktosystemofFigure1.Figure3describesapatternΩ2(3,2)thatmodels3consecutiveoccurrencesofeventsoftypeReq1thatarenotinterleavedwithanyoccurrenceofReq2events(theleftconveyorkeepshavingitsrequestsfulﬁlledwhiletherightconveyorgetsstuck)andthispatternshouldoccur2times(thepatternhasacounter).Thispatternismadeupofnormaleventsbutdeﬁnesabehaviourthatcouldbeunexpected(bothconveyorsatLevel1shouldgetitemsregularly).InthiscaseitisnecessaryﬁrsttoexpressthatinthefuturetheeventReq1isnotfollowedbyReq2untilReq1thatisnotfollowedbyReq2untilReq1.Ξ=♦(Req1∧(cid:13)((¬Req2(cid:116)Req1)∧(cid:13)((¬Req2(cid:116)Req1))).Then,tocheckthatthebehaviourdescribedaboveoccurstwicetheformulaΦΩ2(3,2)isgivenby:ΦΩ2(3,2)=Ξ∧(cid:13)(Ξ∧(cid:13)(♦(ok∧(cid:13)pobs))).TheabsenceofthepatternischeckedthroughΦ¬Ω2(3,2)=(cid:3)(¬(ΦΩ2(3,2))).5.4ResultsanalysisTheSYNapproachhandlemorecomplexproblemsthanthePUREapproachwithsatisfactorysizeofobserva-tionsbutisstillnotaseﬃcientasPROD(seeTable3).BasedonthepatternΩ2(n,counter)ofFigure3,severalcomparisonshavebeenmadewiththePRODapproachbyselectingdiﬀerentvaluesforn(thenumberofReq1),counterandthesizeoftheobservationsequence.Asanex-ampleTable3showstheresultsofthetwoapproachesforoneoccurrenceofﬁveeventsReq1withoutReq2,fortenoccurrencesoftenconsecutiveeventsReq1,withseveralsizesfortheobservationsequence.TheSYNapproachiseﬃcientrelativelytothesizeoftheKripkestructurethatonlydependsontheobservationsequence.Nevertheless,forthesamereasonasforthePUREapproach,SYNislimitedbythelengthofthepatternformula,SYNmustbeonlyconsideredforsmallpatternsonly.6.CONCLUSIONANDFUTUREWORKThispaperaddressesthediagnosisoffaultpatternsinthecontextofPetrinets.ThisproblemisformulatedassizeReq1counternSnTDiagnosisSYN20005166018000ΩFAbsent5000511650120000ΩFAbsent2000101066018000xPROD20005110281223ΩFAbsent5000512598830983ΩFAbsent200010101038812383ΩFAbsentTable3.FaultclassdiagnosiswithoutsilentclosureamodelcheckingproblemusingtheTINAtooltakingbeneﬁtoftheexpressivityofSE-LTL.Accordingtotheknowledgeencodedinthequestionandinthemodel.severalapproachesarepresentedandcompared.Inourperspectives,weplantoinvestigatealternativeapproachestokeepalowcomplexitybothintheformulaandinthemodelsgiventothemodelchecker.OnedirectionwouldbetoconsideranewwayfortheintersectionofPetrinets(Lubatetal.(2019)).Theapplicabilitytoonlinediagnosisisalsoanissue.REFERENCESBerthomieu,B.,Peres,F.,andVernadat,F.(2007).ModelcheckingboundedprioritizedtimePetrinets.InAutomatedTechnologyforVeriﬁcationandAnalysis.Springer.Berthomieu,B.,Ribet,P.O.,andVernadat,F.(2004).Thetooltina–constructionofabstractstatespacesforPetrinetsandtimePetrinets.InternationalJournalofProductionResearch,42(14),2741–2756.Boussif,A.andGhazel,M.(2018).Formalveriﬁcationofintermittentfaultdiagnosabilityofdiscrete-eventsystemsusingmodel-checking.InternationalJournalofCriticalComputer-BasedSystems,8(2),193–213.Clarke,E.,Grumberg,O.,andPeled,D.(1999).Modelchecking.MITpress.Hack,M.(1975).Petrinetlanguages.TechnicalRe-port124,M.I.T.ProjectMAC,ComputationStructuresGroup,MassachusettsInstituteofTechnology.J´eron,T.,Marchand,H.,Pinchinat,S.,andCordier,M.O.(2006).Supervisionpatternsindiscreteeventsystemsdiagnosis.In8thInternationalWorkshoponDiscreteEventSystems,262–268.AnnArbor,MI,UnitedStates.Lamperti,G.andZanella,M.(2003).Continuousdiag-nosisofdiscrete-eventsystems.In14thInternationalWorkshoponPrinciplesofDiagnosisDX03,105–111.WashingtonDC,UnitedStates.Lubat,´E.,DalZilio,S.,LeBotlan,D.,Pencol´e,Y.,andSubias,A.(2019).AStateClassConstructionforCom-putingtheIntersectionofTimePetriNetsLanguages.In17thInternationalConferenceFORMATS,volume11750ofLNCS.Springer,Amsterdam,Netherlands.Pencol´e,Y.andSubias,A.(2017).Diagnosisofsupervi-sionpatternsonboundedlabeledPetrinetsbymodelchecking.In28hInternationalWorkshoponPrinciplesofDiagnosisDX17.Brescia,Italy.Sampath,M.,Sengupta,R.,Lafortune,S.,Sinnamo-hideen,K.,andTeneketzis,D.(1995).Diagnosabilityofdiscrete-eventsystems.TransactionsonAutomaticControl,40(9),1555–1575.